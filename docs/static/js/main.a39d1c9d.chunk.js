(this.webpackJsonpnk=this.webpackJsonpnk||[]).push([[0],{112:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),c=n(29),s=n.n(c),u=(n(98),n(9)),o=n(13),i=n(2),p=n(23),b=(n(99),n(117)),d=n(118),l=n(86),j=n(116),f=(n(100),n(101),n(125)),O=n(124),h=n(114),x=n(115),v=n(122),y=n(123),w=n(32),g=n(58),k=n(37),m=n(14),S=n(27),C=function(e){return function(e){return btoa(String.fromCharCode.apply(null,e))}(new Uint8Array(e))},N=function(e){return String.fromCharCode.apply(null,new Uint16Array(e))},K=function(e){for(var t=new ArrayBuffer(2*e.length),n=new Uint16Array(t),r=0,a=e.length;r<a;r++)n[r]=e.charCodeAt(r);return t},A=function(e){var t=new Uint8Array(e),n=new Uint16Array(e);return[t.subarray(0,12),n.subarray(6)]},E=function(e){return crypto.subtle.importKey("raw",(new TextEncoder).encode(e),{name:"PBKDF2"},!1,["deriveBits","deriveKey"])},I=function(e,t,n){return crypto.subtle.deriveKey({name:"PBKDF2",salt:t,iterations:1e5,hash:"SHA-256"},e,{name:n,length:256},!0,["wrapKey","unwrapKey"])},D=function(){var e=Object(o.a)(Object(u.a)().mark((function e(t,n){var r,a,c,s;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.bytes,a=function(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),r=0,a=e.length;r<a;r++)n[r]=e.charCodeAt(r);return t},c=window.atob(r),s=a(c),e.abrupt("return",crypto.subtle.importKey("pkcs8",s,{name:"RSASSA-PKCS1-v1_5",hash:"SHA-512"},!0,["sign"]));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();function U(e,t){return L.apply(this,arguments)}function L(){return(L=Object(o.a)(Object(u.a)().mark((function e(t,n){var r;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E(t);case 2:return r=e.sent,e.abrupt("return",window.crypto.subtle.deriveKey({name:"PBKDF2",salt:n,iterations:1e5,hash:"SHA-256"},r,{name:"AES-KW",length:256},!0,["wrapKey","unwrapKey"]));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var P,R,V,B=function(){var e=Object(o.a)(Object(u.a)().mark((function e(t,n){var r,a,c,s,o;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.salt,a=t.bytes,c=new Uint8Array(K(r)),s=K(a),e.next=5,U(n,c);case 5:return o=e.sent,e.abrupt("return",window.crypto.subtle.unwrapKey("raw",s,o,"AES-KW","AES-GCM",!0,["encrypt","decrypt"]));case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),T=function(){var e=Object(o.a)(Object(u.a)().mark((function e(t,n){var r,a;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,crypto.subtle.exportKey("pkcs8",t);case 2:return r=e.sent,a={bytes:C(r)},e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),F=function(){var e=Object(o.a)(Object(u.a)().mark((function e(t,n){var r,a,c,s;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E(n);case 2:return r=e.sent,a=crypto.getRandomValues(new Uint8Array(16)),e.next=6,I(r,a,"AES-KW");case 6:return c=e.sent,e.next=9,crypto.subtle.wrapKey("raw",t,c,"AES-KW");case 9:return s=e.sent,e.abrupt("return",{salt:N(a.buffer),bytes:N(s)});case 11:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),z=function(){var e=Object(o.a)(Object(u.a)().mark((function e(t,n){var r;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=JSON.parse(JSON.stringify(t))).keys.signing={},e.prev=2,e.next=5,T(t.keys.signing.privateKey,n);case 5:r.keys.signing.privateKey=e.sent,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),console.log("Could not serialize private key.",e.t0);case 11:return e.prev=11,e.next=14,F(t.keys.encryption,n);case 14:r.keys.encryption=e.sent,e.next=20;break;case 17:e.prev=17,e.t1=e.catch(11),console.log("Could not serialize encryption key.",e.t1);case 20:return e.abrupt("return",JSON.stringify(r));case 21:case"end":return e.stop()}}),e,null,[[2,8],[11,17]])})));return function(t,n){return e.apply(this,arguments)}}(),M=function(){var e=Object(o.a)(Object(u.a)().mark((function e(t,n){var r,a,c,s;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=JSON.parse(t),a=r.keys,c=a.signing.privateKey,s=a.encryption,r.keys={signing:{}},e.prev=3,e.next=6,D(c,n);case 6:r.keys.signing.privateKey=e.sent,e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(3),new Error("Could not create private key.");case 12:return e.prev=12,e.next=15,B(s,n);case 15:r.keys.encryption=e.sent,e.next=21;break;case 18:throw e.prev=18,e.t1=e.catch(12),new Error("Could not create symmetric encryption key.");case 21:return e.abrupt("return",r);case 22:case"end":return e.stop()}}),e,null,[[3,9],[12,18]])})));return function(t,n){return e.apply(this,arguments)}}(),W=function(){var e=Object(o.a)(Object(u.a)().mark((function e(){var t;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:4096,publicExponent:new Uint8Array([1,0,1]),hash:"SHA-512"},!0,["sign","verify"]);case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),_=function(){var e=Object(o.a)(Object(u.a)().mark((function e(){return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),q=function(){return window.crypto.getRandomValues(new Uint8Array(12))},H=function(){var e=Object(o.a)(Object(u.a)().mark((function e(t){var n,r;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,crypto.subtle.exportKey("spki",t);case 3:n=e.sent,e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(0),new Error("Could not export public key: ".concat(e.t0,"."));case 9:return r=C(n).match(/.{1,64}/g).join("\n"),e.abrupt("return","-----BEGIN PUBLIC KEY-----\n".concat(r,"\n-----END PUBLIC KEY-----"));case 11:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),J=function(e){return{name:"AES-GCM",tagLength:128,iv:e}},G=function(e,t,n){return Object(i.a)(Object(i.a)({},e),{},{keys:{signing:t,encryption:n}})},Q=function(e,t){return Object(i.a)(Object(i.a)({},e),{},{keyNames:Object(p.a)(new Set(t))})},X=function(e,t){return Object(i.a)(Object(i.a)({},e),{},{userId:t})},Y=function(e,t,n){return Q(Object(i.a)(Object(i.a)({},e),{},{plaintextValues:Object(i.a)(Object(i.a)({},e.plaintextValues),{},Object(m.a)({},t,n))}),[].concat(Object(p.a)(e.keyNames),[t]))},Z=function(e,t){var n=Object(p.a)(e.keyNames),r=n.indexOf(t);-1!==r&&n.splice(r,1);var a=e.plaintextValues,c=(a[t],Object(g.a)(a,[t].map(k.a)));return Object(i.a)(Object(i.a)({},e),{},{keyNames:n,plaintextValues:c})},$=function(e){return void 0!==e.userId},ee=function(){var e=Object(o.a)(Object(u.a)().mark((function e(t,n,r){var a,c,s,o;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new TextEncoder,c=a.encode(r),e.prev=2,e.next=5,crypto.subtle.encrypt(J(n),t.keys.encryption,c);case 5:s=e.sent,e.next=11;break;case 8:throw e.prev=8,e.t0=e.catch(2),new Error("Could not encrypt value: ".concat(e.t0,"."));case 11:return e.prev=11,e.next=14,window.crypto.subtle.sign({name:"RSASSA-PKCS1-v1_5"},t.keys.signing.privateKey,new Uint8Array(s));case 14:o=e.sent,e.next=20;break;case 17:throw e.prev=17,e.t1=e.catch(11),new Error("Could not sign value: ".concat(e.t1,"."));case 20:return e.abrupt("return",{value:s,signature:o});case 21:case"end":return e.stop()}}),e,null,[[2,8],[11,17]])})));return function(t,n,r){return e.apply(this,arguments)}}(),te=function(){var e=Object(o.a)(Object(u.a)().mark((function e(t,n,r){var a;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,crypto.subtle.decrypt(J(n),t.keys.encryption,r);case 3:a=e.sent,e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(0),new Error("Could not decrypt value: ".concat(e.t0,"."));case 9:return e.abrupt("return",(new TextDecoder).decode(a));case 10:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t,n,r){return e.apply(this,arguments)}}(),ne=function(){var e=Object(o.a)(Object(u.a)().mark((function e(t){var n,r,a,c,s,o;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,W();case 3:n=e.sent,e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(0),new Error("Could not generate signing key pair: ".concat(e.t0,"."));case 9:return e.prev=9,e.next=12,_();case 12:r=e.sent,e.next=18;break;case 15:throw e.prev=15,e.t1=e.catch(9),new Error("Could not generate encryption key: ".concat(e.t1,"."));case 18:return e.next=20,H(n.publicKey);case 20:return a=e.sent,(c=new Headers).append("Content-Type","text/plain"),e.prev=23,e.next=26,fetch("".concat(t.url,"/user"),{method:"post",body:a,headers:c});case 26:return o=e.sent,e.next=29,o.json();case 29:s=e.sent,e.next=35;break;case 32:throw e.prev=32,e.t2=e.catch(23),e.t2;case 35:return e.abrupt("return",G(X(t,s.userId),n,r));case 36:case"end":return e.stop()}}),e,null,[[0,6],[9,15],[23,32]])})));return function(t){return e.apply(this,arguments)}}(),re=function(){var e=Object(o.a)(Object(u.a)().mark((function e(t,n,r){var a,c,s,o,i,p,b,d;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("".concat(t.url,"/proof/").concat(t.userId),{method:"post"});case 3:return c=e.sent,e.next=6,c.json();case 6:a=e.sent,e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(0),new Error("Could not fetch proof: ".concat(e.t0,"."));case 12:if(o=(s=a).success,i=s.error,p=s.value,o){e.next=15;break}throw new Error("Could not fetch proof: ".concat(i,"."));case 15:return e.next=17,crypto.subtle.sign({name:"RSASSA-PKCS1-v1_5",saltLength:32},t.keys.signing.privateKey,(new TextEncoder).encode(p));case 17:return b=e.sent,d=C(b),r||(r={}),r.headers||(r.headers={}),r.headers["X-Nk-Proof"]=p,r.headers["X-Nk-Proof-Sig"]=d,e.next=25,fetch(n,r);case 25:return e.abrupt("return",e.sent);case 26:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,n,r){return e.apply(this,arguments)}}(),ae=function(){var e=Object(o.a)(Object(u.a)().mark((function e(t){var n,r,a,c,s,o;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,re(t,"".concat(t.url,"/data/").concat(t.userId));case 3:return r=e.sent,e.next=6,r.json();case 6:n=e.sent,e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(0),new Error("Could not get keys: ".concat(e.t0,"."));case 12:if(c=(a=n).success,s=a.error,o=a.keys,c){e.next=15;break}throw new Error("Could not get keys: ".concat(s,"."));case 15:return e.abrupt("return",Q(t,o));case 16:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}(),ce=function(){var e=Object(o.a)(Object(u.a)().mark((function e(t,n,r){var a,c,s,o,i,p,b;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.length%2===1&&(r+=" "),a=q(),e.next=4,ee(t,a,r);case 4:return c=e.sent,s=c.value,o=c.signature,(i=new FormData).append("Key",n),i.append("Iv",new Blob([a])),i.append("Sig",new Blob([o])),i.append("Payload",new Blob([s])),e.prev=12,e.next=15,fetch("".concat(t.url,"/data/").concat(t.userId),{method:"post",body:i});case 15:return b=e.sent,e.next=18,b.json();case 18:p=e.sent,e.next=24;break;case 21:throw e.prev=21,e.t0=e.catch(12),new Error("Could not create data: ".concat(e.t0,"."));case 24:if(p.success){e.next=26;break}throw new Error("Could not create data: server returned false.");case 26:return e.abrupt("return",Y(t,n,r));case 27:case"end":return e.stop()}}),e,null,[[12,21]])})));return function(t,n,r){return e.apply(this,arguments)}}(),se=function(){var e=Object(o.a)(Object(u.a)().mark((function e(t,n){var r,a,c,s,o,i,p;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,re(t,"".concat(t.url,"/data/").concat(t.userId,"/").concat(n));case 3:r=e.sent,e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(0),new Error("Could not prove fetch: ".concat(e.t0,"."));case 9:return e.prev=9,e.next=12,r.arrayBuffer();case 12:a=e.sent,e.next=18;break;case 15:throw e.prev=15,e.t1=e.catch(9),new Error("Could not read response: ".concat(e.t1,"."));case 18:return c=A(a),s=Object(S.a)(c,2),o=s[0],i=s[1],e.prev=19,e.next=22,te(t,o,i);case 22:p=e.sent,e.next=28;break;case 25:throw e.prev=25,e.t2=e.catch(19),new Error("Could not decrypt data: ".concat(e.t2,"."));case 28:return e.abrupt("return",Y(t,n,p));case 29:case"end":return e.stop()}}),e,null,[[0,6],[9,15],[19,25]])})));return function(t,n){return e.apply(this,arguments)}}(),ue=function(){var e=Object(o.a)(Object(u.a)().mark((function e(t,n,r){var a,c,s,o,i,p,b;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.length%2===1&&(r+=" "),a=q(),e.next=4,ee(t,a,r);case 4:return c=e.sent,s=c.value,o=c.signature,(i=new FormData).append("Iv",new Blob([a])),i.append("Sig",new Blob([o])),i.append("Payload",new Blob([s])),e.prev=11,e.next=14,fetch("".concat(t.url,"/data/").concat(t.userId,"/").concat(n),{method:"put",body:i});case 14:return b=e.sent,e.next=17,b.json();case 17:p=e.sent,e.next=23;break;case 20:throw e.prev=20,e.t0=e.catch(11),new Error("Could not update data: ".concat(e.t0,"."));case 23:if(p.success){e.next=25;break}throw new Error("Could not update data: server returned false.");case 25:return e.abrupt("return",Y(t,n,r));case 26:case"end":return e.stop()}}),e,null,[[11,20]])})));return function(t,n,r){return e.apply(this,arguments)}}(),oe=function(){var e=Object(o.a)(Object(u.a)().mark((function e(t,n){var r,a;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,re(t,"".concat(t.url,"/data/").concat(t.userId,"/").concat(n),{method:"delete"});case 3:return a=e.sent,e.next=6,a.json();case 6:r=e.sent,e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(0),new Error("Could not delete data: ".concat(e.t0,"."));case 12:if(r.success){e.next=14;break}throw new Error("Could not delete data: server returned false.");case 14:return e.abrupt("return",Z(t,n));case 15:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,n){return e.apply(this,arguments)}}(),ie=n(18),pe=n(64),be=function(e){return{title:e.title,body:e.body,createdAt:(new Date).getTime(),lastUpdatedAt:(new Date).getTime()}},de=function(e){return e?JSON.parse(e):void 0},le=function(e){return e?JSON.stringify(e):void 0},je="unloaded",fe="loading",Oe="loaded",he="saving",xe="deleting",ve="error",ye={isLoggedIn:!1,context:{url:"https://nk-server.thegoldenmule.com",userId:void 0,keys:{signing:void 0,encryption:void 0},keyNames:[],plaintextValues:{}},noteKeys:[],noteValues:{},noteStatuses:{}},we=Object(ie.b)("nk/saveContext",function(){var e=Object(o.a)(Object(u.a)().mark((function e(t,n){var r,a,c;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.getState,a=Ke(r()),e.next=4,z(a,t);case 4:c=e.sent,localStorage.setItem("_context",c);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),ge=Object(ie.b)("nk/new-note",function(){var e=Object(o.a)(Object(u.a)().mark((function e(t,n){var r,a,c,s,o,i,p;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.from,a=n.getState,c=n.rejectWithValue,s=Ke(a()),o="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),i=r||be({title:"New Note",body:""}),e.prev=5,e.next=8,ce(s,o,le(i));case 8:p=e.sent,e.next=14;break;case 11:return e.prev=11,e.t0=e.catch(5),e.abrupt("return",c(e.t0));case 14:return e.abrupt("return",{key:o,note:i,context:p});case 15:case"end":return e.stop()}}),e,null,[[5,11]])})));return function(t,n){return e.apply(this,arguments)}}()),ke=Object(ie.b)("nk/load-note",function(){var e=Object(o.a)(Object(u.a)().mark((function e(t,n){var r,a,c,s,o;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.getState,a=n.rejectWithValue,c=Ke(r()),e.prev=2,e.next=5,se(c,t);case 5:s=e.sent,e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(2),e.abrupt("return",a({key:t,error:e.t0}));case 11:return o=de(s.plaintextValues[t]),e.abrupt("return",{key:t,note:o,context:s});case 13:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t,n){return e.apply(this,arguments)}}()),me=Object(ie.b)("nk/update-note",function(){var e=Object(o.a)(Object(u.a)().mark((function e(t,n){var r,a,c,s,o,i,p,b,d;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.key,a=t.note,c=n.getState,s=n.rejectedWithValue,o=Ie(c()),i=o[r],a.createdAt=i.createdAt||(new Date).getTime(),a.lastUpdatedAt=(new Date).getTime(),p=le(a),b=Ke(c()),e.prev=8,e.next=11,ue(b,r,p);case 11:d=e.sent,e.next=17;break;case 14:return e.prev=14,e.t0=e.catch(8),e.abrupt("return",s({key:r,error:e.t0}));case 17:return e.abrupt("return",{key:r,note:a,context:d});case 18:case"end":return e.stop()}}),e,null,[[8,14]])})));return function(t,n){return e.apply(this,arguments)}}()),Se=Object(ie.b)("nk/delete-note",function(){var e=Object(o.a)(Object(u.a)().mark((function e(t,n){var r,a,c;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.getState,a=n.rejectedWithValue,e.prev=1,e.next=4,oe(Ke(r()),t);case 4:c=e.sent,e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(1),e.abrupt("return",a({key:t,error:e.t0}));case 10:return e.abrupt("return",{key:t,context:c});case 11:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t,n){return e.apply(this,arguments)}}()),Ce=(Object(ie.b)("nk/echo",function(){var e=Object(o.a)(Object(u.a)().mark((function e(t,n){var r,a,c,s,o,i,p,b,d,l,j;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.getState,a=n.rejectedWithValue,c=Math.max(6,Math.floor(1e3*Math.random())),s=new Uint8Array(c),e.next=5,crypto.getRandomValues(s);case 5:return(o=new FormData).append("Payload",new Blob([s])),e.prev=7,e.next=10,fetch("".concat(Ke(r()).url,"/utilities/echo"),{method:"post",body:o});case 10:return p=e.sent,e.next=13,p.arrayBuffer();case 13:i=e.sent,e.next=19;break;case 16:return e.prev=16,e.t0=e.catch(7),e.abrupt("return",a(e.t0));case 19:b=new Uint8Array(s),d=new Uint8Array(i),l=0,j=b.length;case 22:if(!(l<j)){e.next=29;break}if(b[l]===d[l]){e.next=26;break}return console.log("FAILED",c,b,d),e.abrupt("return",a("Values don't match."));case 26:l++,e.next=22;break;case 29:console.log("SUCCEEDED");case 30:case"end":return e.stop()}}),e,null,[[7,16]])})));return function(t,n){return e.apply(this,arguments)}}()),Object(ie.c)({name:"nk",initialState:ye,reducers:{initializeContext:function(e,t){var n,r=t.payload;return Object(i.a)(Object(i.a)({},e),{},{context:r,isLoggedIn:$(r),noteKeys:r.keyNames,notes:(n=r.plaintextValues,Object.fromEntries(Object.entries(n).map((function(e){var t=Object(S.a)(e,2),n=t[0],r=t[1];return[n,de(r)]})))),noteStatuses:Object.fromEntries(r.keyNames.map((function(e){return[e,r.plaintextValues[e]?Oe:je]})))})},logout:function(e){return Object(i.a)(Object(i.a)({},e),{},{isLoggedIn:!1,context:{url:"https://nk-server.thegoldenmule.com",userId:void 0,keys:{signing:void 0,encryption:void 0},keyNames:[],plaintextValues:{}}})}},extraReducers:(P={},Object(m.a)(P,ge.pending,(function(e,t){var n=t.meta.arg;return Object(i.a)(Object(i.a)({},e),{},{noteStatuses:Object(i.a)(Object(i.a)({},e.noteStatuses),{},Object(m.a)({},n,fe))})})),Object(m.a)(P,ge.fulfilled,(function(e,t){var n=t.payload,r=n.key,a=n.note,c=n.context;return Object(i.a)(Object(i.a)({},e),{},{noteKeys:c.keyNames,noteValues:Object(i.a)(Object(i.a)({},e.noteValues),{},Object(m.a)({},r,a)),noteStatus:Object(i.a)(Object(i.a)({},e.noteStatuses),{},Object(m.a)({},r,Oe)),context:c})})),Object(m.a)(P,ge.rejected,(function(e,t){return Object(i.a)({},e)})),Object(m.a)(P,ke.pending,(function(e,t){var n=t.meta.arg;return Object(i.a)(Object(i.a)({},e),{},{nodeStatuses:Object(i.a)(Object(i.a)({},e.noteStatuses),{},Object(m.a)({},n,fe))})})),Object(m.a)(P,ke.fulfilled,(function(e,t){var n=t.payload,r=n.key,a=n.context,c=n.note;return Object(i.a)(Object(i.a)({},e),{},{context:a,noteValues:Object(i.a)(Object(i.a)({},e.noteValues),{},Object(m.a)({},r,c)),noteStatuses:Object(i.a)(Object(i.a)({},e.noteStatuses),{},Object(m.a)({},r,Oe))})})),Object(m.a)(P,ke.rejected,(function(e,t){var n=t.payload,r=n.key;n.error;return Object(i.a)(Object(i.a)({},e),{},{noteStatuses:Object(i.a)(Object(i.a)({},e.noteStatuses),{},Object(m.a)({},r,ve))})})),Object(m.a)(P,me.pending,(function(e,t){var n=t.meta.arg.key;return Object(i.a)(Object(i.a)({},e),{},{noteStatuses:Object(i.a)(Object(i.a)({},e.noteStatuses),{},Object(m.a)({},n,he))})})),Object(m.a)(P,me.fulfilled,(function(e,t){var n=t.payload,r=n.key,a=n.note,c=n.context;return Object(i.a)(Object(i.a)({},e),{},{context:c,noteStatuses:Object(i.a)(Object(i.a)({},e.noteStatuses),{},Object(m.a)({},r,Oe)),noteValues:Object(i.a)(Object(i.a)({},e.noteValues),{},Object(m.a)({},r,a))})})),Object(m.a)(P,me.rejected,(function(e,t){var n=t.key;t.error;return Object(i.a)(Object(i.a)({},e),{},{noteStatuses:Object(i.a)(Object(i.a)({},e.noteStatuses),{},Object(m.a)({},n,ve))})})),Object(m.a)(P,Se.pending,(function(e,t){var n=t.meta.arg;return Object(i.a)(Object(i.a)({},e),{},{noteStatuses:Object(i.a)(Object(i.a)({},e.noteStatuses),{},Object(m.a)({},n,xe))})})),Object(m.a)(P,Se.fulfilled,(function(e,t){var n=t.payload,r=n.key,a=n.context,c=e.noteStatuses,s=(c[r],Object(g.a)(c,[r].map(k.a))),u=e.noteValues,o=(u[r],Object(g.a)(u,[r].map(k.a))),p=a.keyNames;return Object(i.a)(Object(i.a)({},e),{},{context:a,noteKeys:p,noteStatuses:s,noteValues:o})})),Object(m.a)(P,Se.rejected,(function(e,t){var n=t.key;return Object(i.a)(Object(i.a)({},e),{},{noteStatuses:Object(i.a)(Object(i.a)({},e.noteStatuses),{},Object(m.a)({},n,ve))})})),P)})),Ne=function(e){return e.nk},Ke=Object(pe.a)(Ne,(function(e){return e.context})),Ae=Object(pe.a)(Ne,(function(e){return e.isLoggedIn})),Ee=Object(pe.a)(Ne,(function(e){return e.noteKeys})),Ie=Object(pe.a)(Ne,(function(e){return e.noteValues})),De=Object(pe.a)(Ne,(function(e){return e.noteStatuses})),Ue=Ce.actions,Le=Ue.initializeContext,Pe=(Ue.logout,Ce.reducer),Re=n(60),Ve=Object(ie.c)({name:"workspace",initialState:{activeKey:""},reducers:{updateActiveKey:function(e,t){return Object(i.a)(Object(i.a)({},e),{},{activeKey:t.payload})}}}),Be=Object(pe.a)((function(e){return e.workspace}),(function(e){return e.activeKey})),Te=Ve.actions.updateActiveKey,Fe=Ve.reducer,ze=Object(ie.c)({name:"draft",initialState:{drafts:{},newDraft:!1},reducers:{newDraft:function(e,t){var n=t.payload,r=n.key,a=n.note,c=e.drafts[r];return Object(i.a)(Object(i.a)({},e),{},{key:r,drafts:Object(i.a)(Object(i.a)({},e.drafts),{},Object(m.a)({},r,c||Object(i.a)(Object(i.a)({},a),{},{isDirty:!1}))),newDraft:!0})},newDraftUpdatedInternal:function(e){return Object(i.a)(Object(i.a)({},e),{},{newDraft:!1})},updateTitle:function(e,t){var n=t.payload;return Object(i.a)(Object(i.a)({},e),{},{drafts:Object(i.a)(Object(i.a)({},e.drafts),{},Object(m.a)({},e.key,Object(i.a)(Object(i.a)({},e.drafts[e.key]),{},{title:n,isDirty:!0})))})},updateBody:function(e,t){var n=t.payload;return Object(i.a)(Object(i.a)({},e),{},{drafts:Object(i.a)(Object(i.a)({},e.drafts),{},Object(m.a)({},e.key,Object(i.a)(Object(i.a)({},e.drafts[e.key]),{},{body:n,isDirty:!0})))})},draftSaved:function(e,t){var n=t.payload,r=n.key,a=n.note;return Object(i.a)(Object(i.a)({},e),{},{drafts:Object(i.a)(Object(i.a)({},e.drafts),{},Object(m.a)({},r,Object(i.a)(Object(i.a)({},e.drafts[r]),{},{lastUpdatedAt:a.lastUpdatedAt,isDirty:!1})))})}}}),Me=function(e){return e.draft},We=(Object(pe.a)(Me,(function(e){return e.key})),ze.actions),_e=We.newDraft,qe=We.newDraftUpdatedInternal,He=We.updateTitle,Je=We.updateBody,Ge=We.draftSaved,Qe=ze.reducer,Xe="uninitialized",Ye="requestingCredentials",Ze="decrypting",$e="completeLoggedIn",et="completeAnon",tt={phase:Xe,value:"",error:"",contextData:"",context:null},nt=Object(ie.b)("login/submit",function(){var e=Object(o.a)(Object(u.a)().mark((function e(t,n){var r,a,c,s,o,i,p,b;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.getState,a=n.dispatch,c=n.rejectWithValue,s=ct(r()),o=s.value,i=s.contextData,p=at.actions.decrypt,a(p()),e.prev=4,e.next=7,M(i,o);case 7:b=e.sent,e.next=13;break;case 10:return e.prev=10,e.t0=e.catch(4),e.abrupt("return",c("Invalid password."));case 13:return e.prev=13,e.next=16,ae(b);case 16:b=e.sent,e.next=22;break;case 19:return e.prev=19,e.t1=e.catch(13),e.abrupt("return");case 22:return a(Le(b)),e.next=25,a(rt());case 25:return e.abrupt("return");case 26:case"end":return e.stop()}}),e,null,[[4,10],[13,19]])})));return function(t,n){return e.apply(this,arguments)}}()),rt=Object(ie.b)("login/loadAll",function(){var e=Object(o.a)(Object(u.a)().mark((function e(t,n){var r,a,c,s,o,i,p,b,d,l,j;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.getState,a=n.dispatch,c=Ke(r()),s=c.keyNames,o=Object(Re.a)(s),e.prev=3,o.s();case 5:if((i=o.n()).done){e.next=11;break}return p=i.value,e.next=9,a(ke(p));case 9:e.next=5;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(3),o.e(e.t0);case 16:return e.prev=16,o.f(),e.finish(16);case 19:b=Ie(r()),d=Ht(s,b),l=Object(S.a)(d,1),(j=l[0])&&(a(Te(j)),a(_e({key:j,note:b[j]})));case 23:case"end":return e.stop()}}),e,null,[[3,13,16,19]])})));return function(t,n){return e.apply(this,arguments)}}()),at=Object(ie.c)({name:"login",initialState:tt,reducers:{initLogin:function(e,t){var n=localStorage.getItem("_context");return n?Object(i.a)(Object(i.a)({},e),{},{phase:Ye,contextData:n,value:"",error:""}):Object(i.a)(Object(i.a)({},e),{},{phase:et,context:{url:"https://nk-server.thegoldenmule.com",userId:void 0,keys:{signing:void 0,encryption:void 0},keyNames:[],plaintextValues:{}},error:""})},decrypt:function(e){return Object(i.a)(Object(i.a)({},e),{},{phase:Ze})},updatePasswordLogin:function(e,t){var n=t.payload;return Object(i.a)(Object(i.a)({},e),{},{value:n})}},extraReducers:(R={},Object(m.a)(R,nt.rejected,(function(e,t){var n=t.payload;return Object(i.a)(Object(i.a)({},e),{},{phase:Ye,error:n})})),Object(m.a)(R,nt.fulfilled,(function(){return{phase:$e}})),R)}),ct=function(e){return e.login},st=at.actions,ut=st.initLogin,ot=st.updatePasswordLogin,it=at.reducer,pt="requestingCredentials",bt="registering",dt="completeRegistration",lt={phase:"uninitialized",value:"",valueConfirmation:"",error:""},jt=Object(ie.b)("register/submit",function(){var e=Object(o.a)(Object(u.a)().mark((function e(t,n){var r,a,c,s,o,i;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.getState,a=n.dispatch,c=n.rejectedWithValue,e.prev=1,e.next=4,ne({url:"https://nk-server.thegoldenmule.com",userId:void 0,keys:{signing:void 0,encryption:void 0},keyNames:[],plaintextValues:{}});case 4:s=e.sent,e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(1),e.abrupt("return",c(e.t0));case 10:return a(Le(s)),o=Ot(r()),i=o.value,e.next=14,a(we(i));case 14:return e.abrupt("return",{context:s});case 15:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t,n){return e.apply(this,arguments)}}()),ft=Object(ie.c)({name:"register",initialState:lt,reducers:{initRegister:function(e,t){return Object(i.a)(Object(i.a)({},e),{},{phase:pt})},updatePasswordRegister:function(e,t){var n=t.payload;return Object(i.a)(Object(i.a)({},e),{},{value:n})},updatePasswordConfirmationRegister:function(e,t){var n=t.payload;return Object(i.a)(Object(i.a)({},e),{},{valueConfirmation:n})}},extraReducers:(V={},Object(m.a)(V,jt.pending,(function(e){return Object(i.a)(Object(i.a)({},e),{},{phase:bt})})),Object(m.a)(V,jt.rejected,(function(e,t){return{phase:pt,error:t}})),Object(m.a)(V,jt.fulfilled,(function(){return{phase:dt}})),V)}),Ot=function(e){return e.register},ht=ft.actions,xt=ht.initRegister,vt=ht.updatePasswordRegister,yt=ht.updatePasswordConfirmationRegister,wt=ft.reducer,gt=n(4),kt=Object(w.b)((function(e){return{login:ct(e),register:Ot(e),context:Ke(e),isLoggedIn:Ae(e)}}),(function(e){return{dispatchLoginInit:function(){return e(ut())},dispatchUpdateLoginPassword:function(t){return e(ot(t))},dispatchSubmitLoginPassword:function(){return e(nt())},dispatchRegisterInit:function(){return e(xt())},dispatchUpdateRegisterPassword:function(t){return e(vt(t))},dispatchUpdateRegisterPasswordConfirmation:function(t){return e(yt(t))},dispatchSubmitRegisterPassword:function(){return e(jt())}}}))((function(e){var t=e.isLoggedIn,n=e.login,a=e.register,c=e.dispatchLoginInit,s=e.dispatchUpdateLoginPassword,u=e.dispatchSubmitLoginPassword,o=e.dispatchRegisterInit,i=e.dispatchUpdateRegisterPassword,p=e.dispatchUpdateRegisterPasswordConfirmation,w=e.dispatchSubmitRegisterPassword,g=e.dispatchLogout,k=n.phase,m=n.value,S=n.error,C=a.phase,N=a.value,K=a.valueConfirmation,A=a.error;Object(r.useEffect)((function(){return c()}),[c]);var E=Object(r.useRef)(null);Object(r.useEffect)((function(){return E.current&&E.current.focus()}));var I=N&&K&&N===K&&N.length>=8;return Object(gt.jsxs)("div",{children:[Object(gt.jsxs)(v.a,{centered:!0,backdrop:"static",show:k===Ye,children:[Object(gt.jsx)(v.a.Header,{children:Object(gt.jsx)(v.a.Title,{children:"Please enter your password."})}),Object(gt.jsxs)(v.a.Body,{children:[Object(gt.jsx)(y.a.Control,{ref:E,size:"sm",type:"password",placeholder:"Password",value:m,onChange:function(e){return s(e.target.value)}}),S&&Object(gt.jsx)("div",{className:"pt-4",children:Object(gt.jsx)(j.a,{variant:"danger",children:S})})]}),Object(gt.jsx)(v.a.Footer,{children:Object(gt.jsx)(h.a,{variant:"primary",onClick:function(){return u()},children:"Login"})})]}),Object(gt.jsxs)(v.a,{centered:!0,backdrop:"static",show:C===pt,children:[Object(gt.jsx)(v.a.Header,{children:Object(gt.jsx)(v.a.Title,{children:"Please enter a secure password."})}),Object(gt.jsxs)(v.a.Body,{children:[Object(gt.jsx)(y.a.Control,{size:"sm",type:"password",placeholder:"Password",value:N,onChange:function(e){return i(e.target.value)}}),Object(gt.jsx)("div",{className:"p-2"}),Object(gt.jsx)(y.a.Control,{size:"sm",type:"password",placeholder:"Re-enter Password",value:K,onChange:function(e){return p(e.target.value)}}),A&&Object(gt.jsx)("div",{className:"pt-4",children:Object(gt.jsx)(j.a,{variant:"danger",children:A})})]}),Object(gt.jsx)(v.a.Footer,{children:Object(gt.jsx)(h.a,{disabled:!I,variant:"primary",onClick:function(){return w()},children:"Register"})})]}),Object(gt.jsx)(v.a,{centered:!0,backdrop:"static",show:k===Ze||C===bt,children:Object(gt.jsx)(v.a.Body,{children:Object(gt.jsxs)(b.a,{children:[Object(gt.jsx)(d.a,{children:Object(gt.jsx)(l.a,{children:k===k.decrypting?Object(gt.jsx)("p",{className:"text-center lead",children:"Decrypting..."}):Object(gt.jsx)("p",{className:"text-center lead",children:"Generating Keys..."})})}),Object(gt.jsxs)(d.a,{children:[Object(gt.jsx)(l.a,{}),Object(gt.jsx)(l.a,{md:"auto",children:Object(gt.jsx)("img",{src:"./infinity.gif",alt:"Loading..."})}),Object(gt.jsx)(l.a,{})]})]})})}),Object(gt.jsxs)(O.a,{bg:"light",expand:"lg",children:[Object(gt.jsxs)(O.a.Brand,{children:[Object(gt.jsx)("img",{alt:"Logo",width:"44",style:{marginRight:"20px "},src:"logo.png"}),"Nk Notes"]}),Object(gt.jsx)(O.a.Toggle,{"aria-controls":"basic-navbar-nav"}),Object(gt.jsx)(O.a.Collapse,{id:"basic-navbar-nav",className:"justify-content-end",children:t?Object(gt.jsxs)(f.a,{children:[Object(gt.jsx)(O.a.Text,{children:"Signed in.\xa0\xa0"}),Object(gt.jsx)(h.a,{variant:"outline-secondary",onClick:function(){return g()},children:"Logout"})]}):k===Ze||C===bt?Object(gt.jsx)(f.a,{children:Object(gt.jsx)(x.a,{animation:"border",size:"sm",role:"status"})}):k===et||k===Xe?Object(gt.jsx)(f.a,{children:Object(gt.jsx)(h.a,{className:"mr-sm-2",onClick:function(){return o()},children:"Register"})}):k===Ye||C===pt?Object(gt.jsx)(gt.Fragment,{}):void 0})]})]})})),mt=n(126),St=n(119),Ct=n(85),Nt=n(45),Kt=n(46),At=Object(ie.c)({name:"files",initialState:{query:"",searchFocus:0},reducers:{updateQuery:function(e,t){var n=t.payload;return Object(i.a)(Object(i.a)({},e),{},{query:n})},focusSearch:function(e){return Object(i.a)(Object(i.a)({},e),{},{searchFocus:e.searchFocus+1})}}}),Et=function(e){return e.files},It=Object(pe.a)(Et,(function(e){return e.query})),Dt=Object(pe.a)(Et,(function(e){return e.searchFocus})),Ut=At.actions,Lt=Ut.updateQuery,Pt=Ut.focusSearch,Rt=At.reducer,Vt=function(e){return"Escape"===e.code&&!e.ctrlKey&&!e.metaKey&&(e.target.blur(),!0)},Bt=Object(w.b)((function(e){return{query:It(e),searchFocus:Dt(e)}}),(function(e){return{dispatchUpdateQuery:function(t){return e(Lt(t))}}}))((function(e){var t=e.files,n=void 0===t?[]:t,a=e.activeNote,c=e.query,s=e.searchFocus,i=e.dispatchUpdateQuery,p=e.onCreateNote,j=e.onNoteSelected,f=Object(r.useState)(!1),O=Object(S.a)(f,2),v=O[0],y=O[1],w=Object(r.useRef)(null);Object(r.useEffect)((function(){w.current&&w.current.focus()}),[s]);for(var g=[Object(gt.jsx)(mt.a.Item,{children:Object(gt.jsx)(h.a,{variant:"outline-success",onClick:Object(o.a)(Object(u.a)().mark((function e(){return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y(!0),e.next=3,p();case 3:y(!1);case 4:case"end":return e.stop()}}),e)}))),children:v?Object(gt.jsx)(x.a,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true"}):Object(gt.jsx)("span",{children:"+ New Note"})})},"__new__")],k=function(){var e,t=n[m],r=t.key,c=t.name,s=t.lastUpdatedAt,u=t.status,o=new Date;switch(o.setTime(s),u){case ve:e=Object(gt.jsx)(Nt.a,{icon:Kt.b});break;case fe:e=Object(gt.jsx)(x.a,{animation:"border",size:"sm",as:"span"});break;case je:e=Object(gt.jsx)(Nt.a,{icon:Kt.c});break;default:e=Object(gt.jsx)(b.a,{children:Object(gt.jsxs)(d.a,{xs:1,md:1,lg:2,xl:2,children:[Object(gt.jsx)(l.a,{children:Object(gt.jsx)("span",{children:c})}),Object(gt.jsx)(l.a,{children:Object(gt.jsx)("span",{children:Object(gt.jsx)("small",{children:o.toLocaleDateString()})})})]})})}g.push(Object(gt.jsx)(mt.a.Item,{action:!0,active:a===r,onClick:function(){return j(r)},children:e},m))},m=0,C=n.length;m<C;m++)k();return Object(gt.jsxs)("div",{children:[Object(gt.jsx)("div",{className:"pb-4",children:Object(gt.jsxs)(St.a,{children:[Object(gt.jsx)(Ct.a,{ref:w,type:"text",placeholder:"Search",size:"lg",value:c,onChange:function(e){return i(e.target.value)},onKeyDown:Vt}),Object(gt.jsx)(St.a.Append,{children:Object(gt.jsx)(h.a,{variant:"outline-secondary",onClick:function(){return i("")},children:Object(gt.jsx)(Nt.a,{icon:Kt.e})})})]})}),Object(gt.jsx)(mt.a,{children:g})]})})),Tt=n(120),Ft=n(121),zt=n(87),Mt=n(93),Wt=function(e){var t=e.hotkey,n=t.key,r=t.action;return Object(Mt.a)("command+".concat(n,", ctrl+").concat(n),(function(e){e.preventDefault(),r()}),{},[n,r]),null},_t=Object(w.b)((function(e){return{draft:Me(e),isSaving:De(e)[Be(e)]===he}}),(function(e){return{dispatchUpdateTitle:function(t){return e(He(t))},dispatchUpdateBody:function(t){return e(Je(t))},dispatchNewDraftInternal:function(){return e(qe())},dispatchSearchFocus:function(){return e(Pt())}}}))((function(e){var t=e.onSave,n=e.onDuplicate,a=e.onNew,c=e.onDelete,s=e.isSaving,i=e.draft,p=i.key,b=i.drafts,d=i.newDraft,l=e.dispatchNewDraftInternal,j=e.dispatchUpdateTitle,f=e.dispatchUpdateBody,O=e.dispatchSearchFocus,w=b[p]||{},g=w.title,k=w.body,m=w.lastUpdatedAt,C=function(){var e=Object(o.a)(Object(u.a)().mark((function e(){return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t({key:p,title:g,body:k});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),N=function(){var e=Object(o.a)(Object(u.a)().mark((function e(){return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n(p);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),K=function(){var e=Object(o.a)(Object(u.a)().mark((function e(){return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),A=function(){var e=Object(o.a)(Object(u.a)().mark((function e(){return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c(p);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),E=Object(r.useRef)(null),I=Object(r.useRef)(null),D=Object(r.useState)(!1),U=Object(S.a)(D,2),L=U[0],P=U[1],R=[{key:"s",action:C},{key:"d",action:N},{key:"n",action:K},{key:"f",action:O},{key:"e",action:function(){return E.current.getInstance().focus()}},{key:"h",action:function(){return I.current.focus()}},{key:"m",action:function(){E.current&&(E.current.getInstance().isMarkdownMode()?E.current.getInstance().changeMode("wysiwyg"):E.current.getInstance().changeMode("markdown"))}},{key:"Delete",action:function(){return P(!0)}},{key:"Backspace",action:function(){return P(!0)}}],V=R.map((function(e,t){return Object(gt.jsx)(Wt,{hotkey:e},t)}));if(Object(r.useEffect)((function(){d&&(E.current&&(E.current.getInstance().setMarkdown(k),E.current.getInstance().focus()),l())})),!p)return null;var B=new Date;return B.setTime(m),Object(gt.jsxs)("div",{children:[V,Object(gt.jsxs)(v.a,{show:L,onHide:function(){return P(!1)},children:[Object(gt.jsx)(v.a.Header,{children:"Confirm"}),Object(gt.jsx)(v.a.Body,{children:Object(gt.jsx)("p",{children:"Are you sure you want to permanently delete '".concat(g,"'? There will be no way to recover this note.")})}),Object(gt.jsxs)(v.a.Footer,{children:[Object(gt.jsx)(h.a,{variant:"secondary",onClick:function(){return P(!1)},children:"Close"}),Object(gt.jsx)(h.a,{variant:"danger",onClick:Object(o.a)(Object(u.a)().mark((function e(){return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A();case 2:P(!1);case 3:case"end":return e.stop()}}),e)}))),children:"Delete"})]})]}),Object(gt.jsx)("div",{className:"pb-4",children:Object(gt.jsx)(y.a.Control,{ref:I,size:"lg",type:"text",placeholder:"Title",value:g,onChange:function(e){return j(e.target.value)},onKeyDown:Vt})}),Object(gt.jsx)("div",{className:"pb-4",children:Object(gt.jsxs)(Tt.a,{className:"justify-content-between",children:[Object(gt.jsxs)(Ft.a,{children:[Object(gt.jsx)(h.a,{onClick:C,children:s?Object(gt.jsx)(x.a,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true"}):Object(gt.jsx)(Nt.a,{icon:Kt.d})}),Object(gt.jsx)(h.a,{variant:"outline-secondary",onClick:N,children:Object(gt.jsx)(Nt.a,{icon:Kt.a})})]}),Object(gt.jsx)("p",{className:"mb-0 mt-2",children:Object(gt.jsxs)("small",{children:["Last saved ",B.toLocaleString("en-US")]})}),Object(gt.jsx)(Ft.a,{children:Object(gt.jsx)(h.a,{variant:"outline-danger",onClick:function(){return P(!0)},children:Object(gt.jsx)(Nt.a,{icon:Kt.f})})})]})}),Object(gt.jsx)(zt.a,{ref:E,initialValue:k,placeholder:"Start writing",previewStyle:"vertical",height:"600px",initialEditType:"wysiwyg",useCommandShortcut:!1,usageStatistics:!1,onChange:function(){var e=E.current.getInstance().getMarkdown();k!==e&&f(e)},onKeydown:function(){var e=Object(o.a)(Object(u.a)().mark((function e(t){var n,r,a,c;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.data.key,!(t.data.metaKey&&!t.data.ctrlKey||t.data.ctrlKey&&!t.data.metaKey)){e.next=14;break}r=0,a=R;case 3:if(!(r<a.length)){e.next=12;break}if((c=a[r]).key!==n){e.next=9;break}return t.data.preventDefault(),e.next=9,c.action();case 9:r++,e.next=3;break;case 12:e.next=15;break;case 14:"Escape"===n&&E.current.getInstance().blur();case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()})]})})),qt=n(90),Ht=function(e,t){var n=Object(p.a)(e);return n.sort((function(e,n){var r=t[e],a=t[n];return r?a?a.lastUpdatedAt-r.lastUpdatedAt:-1:1})),n};var Jt=Object(w.b)((function(e){return{login:ct(e),context:Ke(e),isLoggedIn:Ae(e),activeKey:Be(e),noteKeys:Ee(e),noteValues:Ie(e),noteStatuses:De(e),draft:Me(e),query:It(e)}}),(function(e){return{dispatchNewNote:function(t){return e(ge({from:t}))},dispatchLoadNote:function(t){return e(ke(t))},dispatchUpdateNote:function(){var t=Object(o.a)(Object(u.a)().mark((function t(n){var r,a,c,s,o;return Object(u.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.key,a=n.note,t.next=3,e(me({key:r,note:a}));case 3:return c=t.sent,t.prev=4,t.next=7,Object(ie.d)(c);case 7:s=t.sent,t.next=13;break;case 10:return t.prev=10,t.t0=t.catch(4),t.abrupt("return",c);case 13:return o=s.note,e(Ge({note:o,key:r})),t.abrupt("return",c);case 16:case"end":return t.stop()}}),t,null,[[4,10]])})));return function(e){return t.apply(this,arguments)}}(),dispatchDeleteNote:function(){var t=Object(o.a)(Object(u.a)().mark((function t(n){return Object(u.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e(Se(n));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),dispatchUpdateActiveKey:function(t){var n=t.key,r=t.note;e(Te(n)),e(_e({key:n,note:r}))}}}))((function(e){var t,n=e.context,a=e.isLoggedIn,c=e.activeKey,s=e.dispatchUpdateActiveKey,p=e.noteKeys,f=e.noteValues,O=e.noteStatuses,h=e.draft,x=e.query,v=e.dispatchNewNote,y=e.dispatchLoadNote,w=e.dispatchUpdateNote,g=e.dispatchDeleteNote,k=Object(r.useRef)(new qt.a([],{includeScore:!0,ignoreLocation:!0,shouldSort:!0,keys:["title","body"]}));if(Object(r.useEffect)((function(){var e=p.map((function(e){return Object(i.a)({key:e},f[e]||{})}));k.current.setCollection(e)}),[O,p,f]),x){var m=k.current.search(x);t=m.map((function(e){return e.item.key}))}else t=Ht(p,f);var S=t.map((function(e){var t=O[e],n=(h.drafts[e]||{}).isDirty,r=(f[e]||{}).lastUpdatedAt,a=f[e];if(a){var c=a.title;return{key:e,name:"".concat(c).concat(n?"*":""),status:t,lastUpdatedAt:r}}return{key:e,name:e,status:t,lastUpdatedAt:r}})),C=function(){var e=Object(o.a)(Object(u.a)().mark((function e(t){var n,r,a,c,o;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v(t);case 2:return n=e.sent,e.prev=3,e.next=6,Object(ie.d)(n);case 6:r=e.sent,e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(3),e.abrupt("return");case 12:c=(a=r).key,o=a.note,s({key:c,note:o});case 14:case"end":return e.stop()}}),e,null,[[3,9]])})));return function(t){return e.apply(this,arguments)}}(),N=function(){var e=Object(o.a)(Object(u.a)().mark((function e(){return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w({key:c,note:be({title:h.drafts[c].title,body:h.drafts[c].body})});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),K=function(){var e=Object(o.a)(Object(u.a)().mark((function e(t){var n;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=de(le(f[t]))).title+=" (Copy)",e.next=4,C(n);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),A=function(){var e=Object(o.a)(Object(u.a)().mark((function e(){var n,r,a;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g(c);case 2:n=0,r=t.length;case 3:if(!(n<r)){e.next=12;break}if((a=t[n])===c){e.next=9;break}return e.next=8,s({key:a,note:f[a]});case 8:return e.abrupt("return",e.sent);case 9:n++,e.next=3;break;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),E=function(){var e=Object(o.a)(Object(u.a)().mark((function e(t){var n,r;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=f[t]){e.next=13;break}return e.next=4,y(t);case 4:r=e.sent,e.prev=5,r=Object(ie.d)(r),n=r.note,e.next=13;break;case 10:return e.prev=10,e.t0=e.catch(5),e.abrupt("return");case 13:s({key:t,note:n});case 14:case"end":return e.stop()}}),e,null,[[5,10]])})));return function(t){return e.apply(this,arguments)}}();return Object(gt.jsxs)(b.a,{className:"h-100 mh-100",children:[Object(gt.jsx)(kt,{context:n}),a&&Object(gt.jsxs)(d.a,{className:"p-2 h-100",children:[Object(gt.jsx)(l.a,{className:"p-2",xs:4,children:Object(gt.jsx)(Bt,{files:S,activeNote:c,onCreateNote:C,onNoteSelected:E})}),Object(gt.jsx)(l.a,{className:"p-2 h-100",children:Object(gt.jsx)(_t,{onSave:N,onDuplicate:K,onDelete:A})})]}),!a&&Object(gt.jsx)(d.a,{className:"pt-5",children:Object(gt.jsx)(l.a,{children:Object(gt.jsx)(j.a,{variant:"dark",children:"Register or login to continue."})})})]})})),Gt=(n(111),n(59)),Qt=n(92),Xt=Object(ie.a)({reducer:{nk:Pe,workspace:Fe,draft:Qe,files:Rt,login:it,register:wt},middleware:[Gt.a,Qt.a]});s.a.render(Object(gt.jsx)(a.a.StrictMode,{children:Object(gt.jsx)(w.a,{store:Xt,children:Object(gt.jsx)(Jt,{})})}),document.getElementById("root"))},98:function(e,t,n){},99:function(e,t,n){}},[[112,1,2]]]);
//# sourceMappingURL=main.a39d1c9d.chunk.js.map