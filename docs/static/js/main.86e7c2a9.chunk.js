(this.webpackJsonpexample=this.webpackJsonpexample||[]).push([[0],{78:function(e,t,n){},80:function(e,t,n){},97:function(e,t,n){"use strict";n.r(t);var r=n(3),a=n(0),c=n.n(a),s=n(20),u=n.n(s),o=(n(78),n(5)),i=n.n(o),p=n(9),d=n(1),l=n(13),b=(n(80),n(102)),f=n(103),j=n(68),h=n(101),x=(n(81),n(82),n(110)),O=n(109),v=n(99),y=n(100),w=n(107),g=n(108),k=n(21),m=n(42),S=n(45),C=n(10),N=n(22),K=function(e){return function(e){return btoa(String.fromCharCode.apply(null,e))}(new Uint8Array(e))},A=function(e){return String.fromCharCode.apply(null,new Uint16Array(e))},E=function(e){for(var t=new ArrayBuffer(2*e.length),n=new Uint16Array(t),r=0,a=e.length;r<a;r++)n[r]=e.charCodeAt(r);return t},I=function(e){var t=new Uint8Array(e),n=new Uint16Array(e);return[t.subarray(0,12),n.subarray(6)]},D=function(e){return crypto.subtle.importKey("raw",(new TextEncoder).encode(e),{name:"PBKDF2"},!1,["deriveBits","deriveKey"])},U=function(e,t,n){return crypto.subtle.deriveKey({name:"PBKDF2",salt:t,iterations:1e5,hash:"SHA-256"},e,{name:n,length:256},!0,["wrapKey","unwrapKey"])},L=function(){var e=Object(p.a)(i.a.mark((function e(t,n){var r,a,c,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.bytes,a=function(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),r=0,a=e.length;r<a;r++)n[r]=e.charCodeAt(r);return t},c=window.atob(r),s=a(c),e.abrupt("return",crypto.subtle.importKey("pkcs8",s,{name:"RSASSA-PKCS1-v1_5",hash:"SHA-512"},!0,["sign"]));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();function P(e,t){return R.apply(this,arguments)}function R(){return(R=Object(p.a)(i.a.mark((function e(t,n){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D(t);case 2:return r=e.sent,e.abrupt("return",window.crypto.subtle.deriveKey({name:"PBKDF2",salt:n,iterations:1e5,hash:"SHA-256"},r,{name:"AES-KW",length:256},!0,["wrapKey","unwrapKey"]));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var V,B,T,F=function(){var e=Object(p.a)(i.a.mark((function e(t,n){var r,a,c,s,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.salt,a=t.bytes,c=new Uint8Array(E(r)),s=E(a),e.next=5,P(n,c);case 5:return u=e.sent,e.abrupt("return",window.crypto.subtle.unwrapKey("raw",s,u,"AES-KW","AES-GCM",!0,["encrypt","decrypt"]));case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),z=function(){var e=Object(p.a)(i.a.mark((function e(t,n){var r,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,crypto.subtle.exportKey("pkcs8",t);case 2:return r=e.sent,a={bytes:K(r)},e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),M=function(){var e=Object(p.a)(i.a.mark((function e(t,n){var r,a,c,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D(n);case 2:return r=e.sent,a=crypto.getRandomValues(new Uint8Array(16)),e.next=6,U(r,a,"AES-KW");case 6:return c=e.sent,e.next=9,crypto.subtle.wrapKey("raw",t,c,"AES-KW");case 9:return s=e.sent,e.abrupt("return",{salt:A(a.buffer),bytes:A(s)});case 11:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),W=function(){var e=Object(p.a)(i.a.mark((function e(t,n){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=JSON.parse(JSON.stringify(t))).keys.signing={},e.prev=2,e.next=5,z(t.keys.signing.privateKey,n);case 5:r.keys.signing.privateKey=e.sent,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),console.log("Could not serialize private key.",e.t0);case 11:return e.prev=11,e.next=14,M(t.keys.encryption,n);case 14:r.keys.encryption=e.sent,e.next=20;break;case 17:e.prev=17,e.t1=e.catch(11),console.log("Could not serialize encryption key.",e.t1);case 20:return e.abrupt("return",JSON.stringify(r));case 21:case"end":return e.stop()}}),e,null,[[2,8],[11,17]])})));return function(t,n){return e.apply(this,arguments)}}(),_=function(){var e=Object(p.a)(i.a.mark((function e(t,n){var r,a,c,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=JSON.parse(t),a=r.keys,c=a.signing.privateKey,s=a.encryption,r.keys={signing:{}},e.prev=3,e.next=6,L(c,n);case 6:r.keys.signing.privateKey=e.sent,e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(3),new Error("Could not create private key.");case 12:return e.prev=12,e.next=15,F(s,n);case 15:r.keys.encryption=e.sent,e.next=21;break;case 18:throw e.prev=18,e.t1=e.catch(12),new Error("Could not create symmetric encryption key.");case 21:return e.abrupt("return",r);case 22:case"end":return e.stop()}}),e,null,[[3,9],[12,18]])})));return function(t,n){return e.apply(this,arguments)}}(),q=function(){var e=Object(p.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:4096,publicExponent:new Uint8Array([1,0,1]),hash:"SHA-512"},!0,["sign","verify"]);case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),H=function(){var e=Object(p.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),J=function(){return window.crypto.getRandomValues(new Uint8Array(12))},G=function(){var e=Object(p.a)(i.a.mark((function e(t){var n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,crypto.subtle.exportKey("spki",t);case 3:n=e.sent,e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(0),new Error("Could not export public key: ".concat(e.t0,"."));case 9:return r=K(n).match(/.{1,64}/g).join("\n"),e.abrupt("return","-----BEGIN PUBLIC KEY-----\n".concat(r,"\n-----END PUBLIC KEY-----"));case 11:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),Q=function(e){return{name:"AES-GCM",tagLength:128,iv:e}},X=function(e,t,n){return Object(d.a)(Object(d.a)({},e),{},{keys:{signing:t,encryption:n}})},Y=function(e,t){return Object(d.a)(Object(d.a)({},e),{},{keyNames:Object(l.a)(new Set(t))})},Z=function(e,t){return Object(d.a)(Object(d.a)({},e),{},{userId:t})},$=function(e,t,n){return Y(Object(d.a)(Object(d.a)({},e),{},{plaintextValues:Object(d.a)(Object(d.a)({},e.plaintextValues),{},Object(C.a)({},t,n))}),[].concat(Object(l.a)(e.keyNames),[t]))},ee=function(e,t){var n=Object(l.a)(e.keyNames),r=n.indexOf(t);-1!==r&&n.splice(r,1);var a=e.plaintextValues,c=(a[t],Object(m.a)(a,[t].map(S.a)));return Object(d.a)(Object(d.a)({},e),{},{keyNames:n,plaintextValues:c})},te=function(e){return void 0!==e.userId},ne=function(){var e=Object(p.a)(i.a.mark((function e(t,n,r){var a,c,s,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new TextEncoder,c=a.encode(r),e.prev=2,e.next=5,crypto.subtle.encrypt(Q(n),t.keys.encryption,c);case 5:s=e.sent,e.next=11;break;case 8:throw e.prev=8,e.t0=e.catch(2),new Error("Could not encrypt value: ".concat(e.t0,"."));case 11:return e.prev=11,e.next=14,window.crypto.subtle.sign({name:"RSASSA-PKCS1-v1_5"},t.keys.signing.privateKey,new Uint8Array(s));case 14:u=e.sent,e.next=20;break;case 17:throw e.prev=17,e.t1=e.catch(11),new Error("Could not sign value: ".concat(e.t1,"."));case 20:return e.abrupt("return",{value:s,signature:u});case 21:case"end":return e.stop()}}),e,null,[[2,8],[11,17]])})));return function(t,n,r){return e.apply(this,arguments)}}(),re=function(){var e=Object(p.a)(i.a.mark((function e(t,n,r){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,crypto.subtle.decrypt(Q(n),t.keys.encryption,r);case 3:a=e.sent,e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(0),new Error("Could not decrypt value: ".concat(e.t0,"."));case 9:return e.abrupt("return",(new TextDecoder).decode(a));case 10:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t,n,r){return e.apply(this,arguments)}}(),ae=function(){var e=Object(p.a)(i.a.mark((function e(t){var n,r,a,c,s,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,q();case 3:n=e.sent,e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(0),new Error("Could not generate signing key pair: ".concat(e.t0,"."));case 9:return e.prev=9,e.next=12,H();case 12:r=e.sent,e.next=18;break;case 15:throw e.prev=15,e.t1=e.catch(9),new Error("Could not generate encryption key: ".concat(e.t1,"."));case 18:return e.next=20,G(n.publicKey);case 20:return a=e.sent,(c=new Headers).append("Content-Type","text/plain"),e.prev=23,e.next=26,fetch("".concat(t.url,"/user"),{method:"post",body:a,headers:c});case 26:return u=e.sent,e.next=29,u.json();case 29:s=e.sent,e.next=35;break;case 32:throw e.prev=32,e.t2=e.catch(23),e.t2;case 35:return e.abrupt("return",X(Z(t,s.userId),n,r));case 36:case"end":return e.stop()}}),e,null,[[0,6],[9,15],[23,32]])})));return function(t){return e.apply(this,arguments)}}(),ce=function(){var e=Object(p.a)(i.a.mark((function e(t,n,r){var a,c,s,u,o,p,d,l;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("".concat(t.url,"/proof/").concat(t.userId),{method:"post"});case 3:return c=e.sent,e.next=6,c.json();case 6:a=e.sent,e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(0),new Error("Could not fetch proof: ".concat(e.t0,"."));case 12:if(u=(s=a).success,o=s.error,p=s.value,u){e.next=15;break}throw new Error("Could not fetch proof: ".concat(o,"."));case 15:return e.next=17,crypto.subtle.sign({name:"RSASSA-PKCS1-v1_5",saltLength:32},t.keys.signing.privateKey,(new TextEncoder).encode(p));case 17:return d=e.sent,l=K(d),r||(r={}),r.headers||(r.headers={}),r.headers["X-Nk-Proof"]=p,r.headers["X-Nk-Proof-Sig"]=l,e.next=25,fetch(n,r);case 25:return e.abrupt("return",e.sent);case 26:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,n,r){return e.apply(this,arguments)}}(),se=function(){var e=Object(p.a)(i.a.mark((function e(t){var n,r,a,c,s,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ce(t,"".concat(t.url,"/data/").concat(t.userId));case 3:return r=e.sent,e.next=6,r.json();case 6:n=e.sent,e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(0),new Error("Could not get keys: ".concat(e.t0,"."));case 12:if(c=(a=n).success,s=a.error,u=a.keys,c){e.next=15;break}throw new Error("Could not get keys: ".concat(s,"."));case 15:return e.abrupt("return",Y(t,u));case 16:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}(),ue=function(){var e=Object(p.a)(i.a.mark((function e(t,n,r){var a,c,s,u,o,p,d;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.length%2===1&&(r+=" "),a=J(),e.next=4,ne(t,a,r);case 4:return c=e.sent,s=c.value,u=c.signature,(o=new FormData).append("Key",n),o.append("Iv",new Blob([a])),o.append("Sig",new Blob([u])),o.append("Payload",new Blob([s])),e.prev=12,e.next=15,fetch("".concat(t.url,"/data/").concat(t.userId),{method:"post",body:o});case 15:return d=e.sent,e.next=18,d.json();case 18:p=e.sent,e.next=24;break;case 21:throw e.prev=21,e.t0=e.catch(12),new Error("Could not create data: ".concat(e.t0,"."));case 24:if(p.success){e.next=26;break}throw new Error("Could not create data: server returned false.");case 26:return e.abrupt("return",$(t,n,r));case 27:case"end":return e.stop()}}),e,null,[[12,21]])})));return function(t,n,r){return e.apply(this,arguments)}}(),oe=function(){var e=Object(p.a)(i.a.mark((function e(t,n){var r,a,c,s,u,o,p;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ce(t,"".concat(t.url,"/data/").concat(t.userId,"/").concat(n));case 3:r=e.sent,e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(0),new Error("Could not prove fetch: ".concat(e.t0,"."));case 9:return e.prev=9,e.next=12,r.arrayBuffer();case 12:a=e.sent,e.next=18;break;case 15:throw e.prev=15,e.t1=e.catch(9),new Error("Could not read response: ".concat(e.t1,"."));case 18:return c=I(a),s=Object(N.a)(c,2),u=s[0],o=s[1],e.prev=19,e.next=22,re(t,u,o);case 22:p=e.sent,e.next=28;break;case 25:throw e.prev=25,e.t2=e.catch(19),new Error("Could not decrypt data: ".concat(e.t2,"."));case 28:return e.abrupt("return",$(t,n,p));case 29:case"end":return e.stop()}}),e,null,[[0,6],[9,15],[19,25]])})));return function(t,n){return e.apply(this,arguments)}}(),ie=function(){var e=Object(p.a)(i.a.mark((function e(t,n,r){var a,c,s,u,o,p,d;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.length%2===1&&(r+=" "),a=J(),e.next=4,ne(t,a,r);case 4:return c=e.sent,s=c.value,u=c.signature,(o=new FormData).append("Iv",new Blob([a])),o.append("Sig",new Blob([u])),o.append("Payload",new Blob([s])),e.prev=11,e.next=14,fetch("".concat(t.url,"/data/").concat(t.userId,"/").concat(n),{method:"put",body:o});case 14:return d=e.sent,e.next=17,d.json();case 17:p=e.sent,e.next=23;break;case 20:throw e.prev=20,e.t0=e.catch(11),new Error("Could not update data: ".concat(e.t0,"."));case 23:if(p.success){e.next=25;break}throw new Error("Could not update data: server returned false.");case 25:return e.abrupt("return",$(t,n,r));case 26:case"end":return e.stop()}}),e,null,[[11,20]])})));return function(t,n,r){return e.apply(this,arguments)}}(),pe=function(){var e=Object(p.a)(i.a.mark((function e(t,n){var r,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ce(t,"".concat(t.url,"/data/").concat(t.userId,"/").concat(n),{method:"delete"});case 3:return a=e.sent,e.next=6,a.json();case 6:r=e.sent,e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(0),new Error("Could not delete data: ".concat(e.t0,"."));case 12:if(r.success){e.next=14;break}throw new Error("Could not delete data: server returned false.");case 14:return e.abrupt("return",ee(t,n));case 15:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,n){return e.apply(this,arguments)}}(),de=n(11),le=n(48),be=function(e){return{title:e.title,body:e.body,createdAt:(new Date).getTime(),lastUpdatedAt:(new Date).getTime()}},fe=function(e){return e?JSON.parse(e):void 0},je=function(e){return e?JSON.stringify(e):void 0},he="unloaded",xe="loading",Oe="loaded",ve="saving",ye="deleting",we="error",ge={isLoggedIn:!1,context:{url:"http://localhost",userId:void 0,keys:{signing:void 0,encryption:void 0},keyNames:[],plaintextValues:{}},noteKeys:[],noteValues:{},noteStatuses:{}},ke=Object(de.b)("nk/saveContext",function(){var e=Object(p.a)(i.a.mark((function e(t,n){var r,a,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.getState,a=Ee(r()),e.next=4,W(a,t);case 4:c=e.sent,localStorage.setItem("_context",c);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),me=Object(de.b)("nk/new-note",function(){var e=Object(p.a)(i.a.mark((function e(t,n){var r,a,c,s,u,o,p;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.from,a=n.getState,c=n.rejectWithValue,s=Ee(a()),u="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),o=r||be({title:"New Note",body:""}),e.prev=5,e.next=8,ue(s,u,je(o));case 8:p=e.sent,e.next=14;break;case 11:return e.prev=11,e.t0=e.catch(5),e.abrupt("return",c(e.t0));case 14:return e.abrupt("return",{key:u,note:o,context:p});case 15:case"end":return e.stop()}}),e,null,[[5,11]])})));return function(t,n){return e.apply(this,arguments)}}()),Se=Object(de.b)("nk/load-note",function(){var e=Object(p.a)(i.a.mark((function e(t,n){var r,a,c,s,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.getState,a=n.rejectWithValue,c=Ee(r()),e.prev=2,e.next=5,oe(c,t);case 5:s=e.sent,e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(2),e.abrupt("return",a({key:t,error:e.t0}));case 11:return u=fe(s.plaintextValues[t]),e.abrupt("return",{key:t,note:u,context:s});case 13:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t,n){return e.apply(this,arguments)}}()),Ce=Object(de.b)("nk/update-note",function(){var e=Object(p.a)(i.a.mark((function e(t,n){var r,a,c,s,u,o,p,d,l;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.key,a=t.note,c=n.getState,s=n.rejectedWithValue,u=Ue(c()),o=u[r],a.createdAt=o.createdAt||(new Date).getTime(),a.lastUpdatedAt=(new Date).getTime(),p=je(a),d=Ee(c()),e.prev=8,e.next=11,ie(d,r,p);case 11:l=e.sent,e.next=17;break;case 14:return e.prev=14,e.t0=e.catch(8),e.abrupt("return",s({key:r,error:e.t0}));case 17:return e.abrupt("return",{key:r,note:a,context:l});case 18:case"end":return e.stop()}}),e,null,[[8,14]])})));return function(t,n){return e.apply(this,arguments)}}()),Ne=Object(de.b)("nk/delete-note",function(){var e=Object(p.a)(i.a.mark((function e(t,n){var r,a,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.getState,a=n.rejectedWithValue,e.prev=1,e.next=4,pe(Ee(r()),t);case 4:c=e.sent,e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(1),e.abrupt("return",a({key:t,error:e.t0}));case 10:return e.abrupt("return",{key:t,context:c});case 11:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t,n){return e.apply(this,arguments)}}()),Ke=(Object(de.b)("nk/echo",function(){var e=Object(p.a)(i.a.mark((function e(t,n){var r,a,c,s,u,o,p,d,l,b,f;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.getState,a=n.rejectedWithValue,c=Math.max(6,Math.floor(1e3*Math.random())),s=new Uint8Array(c),e.next=5,crypto.getRandomValues(s);case 5:return(u=new FormData).append("Payload",new Blob([s])),e.prev=7,e.next=10,fetch("".concat(Ee(r()).url,"/utilities/echo"),{method:"post",body:u});case 10:return p=e.sent,e.next=13,p.arrayBuffer();case 13:o=e.sent,e.next=19;break;case 16:return e.prev=16,e.t0=e.catch(7),e.abrupt("return",a(e.t0));case 19:d=new Uint8Array(s),l=new Uint8Array(o),b=0,f=d.length;case 22:if(!(b<f)){e.next=29;break}if(d[b]===l[b]){e.next=26;break}return console.log("FAILED",c,d,l),e.abrupt("return",a("Values don't match."));case 26:b++,e.next=22;break;case 29:console.log("SUCCEEDED");case 30:case"end":return e.stop()}}),e,null,[[7,16]])})));return function(t,n){return e.apply(this,arguments)}}()),Object(de.c)({name:"nk",initialState:ge,reducers:{initializeContext:function(e,t){var n,r=t.payload;return Object(d.a)(Object(d.a)({},e),{},{context:r,isLoggedIn:te(r),noteKeys:r.keyNames,notes:(n=r.plaintextValues,Object.fromEntries(Object.entries(n).map((function(e){var t=Object(N.a)(e,2),n=t[0],r=t[1];return[n,fe(r)]})))),noteStatuses:Object.fromEntries(r.keyNames.map((function(e){return[e,r.plaintextValues[e]?Oe:he]})))})},logout:function(e){return Object(d.a)(Object(d.a)({},e),{},{isLoggedIn:!1,context:{url:"http://localhost",userId:void 0,keys:{signing:void 0,encryption:void 0},keyNames:[],plaintextValues:{}}})}},extraReducers:(V={},Object(C.a)(V,me.pending,(function(e,t){var n=t.meta.arg;return Object(d.a)(Object(d.a)({},e),{},{noteStatuses:Object(d.a)(Object(d.a)({},e.noteStatuses),{},Object(C.a)({},n,xe))})})),Object(C.a)(V,me.fulfilled,(function(e,t){var n=t.payload,r=n.key,a=n.note,c=n.context;return Object(d.a)(Object(d.a)({},e),{},{noteKeys:c.keyNames,noteValues:Object(d.a)(Object(d.a)({},e.noteValues),{},Object(C.a)({},r,a)),noteStatus:Object(d.a)(Object(d.a)({},e.noteStatuses),{},Object(C.a)({},r,Oe)),context:c})})),Object(C.a)(V,me.rejected,(function(e,t){return Object(d.a)({},e)})),Object(C.a)(V,Se.pending,(function(e,t){var n=t.meta.arg;return Object(d.a)(Object(d.a)({},e),{},{nodeStatuses:Object(d.a)(Object(d.a)({},e.noteStatuses),{},Object(C.a)({},n,xe))})})),Object(C.a)(V,Se.fulfilled,(function(e,t){var n=t.payload,r=n.key,a=n.context,c=n.note;return Object(d.a)(Object(d.a)({},e),{},{context:a,noteValues:Object(d.a)(Object(d.a)({},e.noteValues),{},Object(C.a)({},r,c)),noteStatuses:Object(d.a)(Object(d.a)({},e.noteStatuses),{},Object(C.a)({},r,Oe))})})),Object(C.a)(V,Se.rejected,(function(e,t){var n=t.payload,r=n.key;n.error;return Object(d.a)(Object(d.a)({},e),{},{noteStatuses:Object(d.a)(Object(d.a)({},e.noteStatuses),{},Object(C.a)({},r,we))})})),Object(C.a)(V,Ce.pending,(function(e,t){var n=t.meta.arg.key;return Object(d.a)(Object(d.a)({},e),{},{noteStatuses:Object(d.a)(Object(d.a)({},e.noteStatuses),{},Object(C.a)({},n,ve))})})),Object(C.a)(V,Ce.fulfilled,(function(e,t){var n=t.payload,r=n.key,a=n.note,c=n.context;return Object(d.a)(Object(d.a)({},e),{},{context:c,noteStatuses:Object(d.a)(Object(d.a)({},e.noteStatuses),{},Object(C.a)({},r,Oe)),noteValues:Object(d.a)(Object(d.a)({},e.noteValues),{},Object(C.a)({},r,a))})})),Object(C.a)(V,Ce.rejected,(function(e,t){var n=t.key;t.error;return Object(d.a)(Object(d.a)({},e),{},{noteStatuses:Object(d.a)(Object(d.a)({},e.noteStatuses),{},Object(C.a)({},n,we))})})),Object(C.a)(V,Ne.pending,(function(e,t){var n=t.meta.arg;return Object(d.a)(Object(d.a)({},e),{},{noteStatuses:Object(d.a)(Object(d.a)({},e.noteStatuses),{},Object(C.a)({},n,ye))})})),Object(C.a)(V,Ne.fulfilled,(function(e,t){var n=t.payload,r=n.key,a=n.context,c=e.noteStatuses,s=(c[r],Object(m.a)(c,[r].map(S.a))),u=e.noteValues,o=(u[r],Object(m.a)(u,[r].map(S.a))),i=a.keyNames;return Object(d.a)(Object(d.a)({},e),{},{context:a,noteKeys:i,noteStatuses:s,noteValues:o})})),Object(C.a)(V,Ne.rejected,(function(e,t){var n=t.key;return Object(d.a)(Object(d.a)({},e),{},{noteStatuses:Object(d.a)(Object(d.a)({},e.noteStatuses),{},Object(C.a)({},n,we))})})),V)})),Ae=function(e){return e.nk},Ee=Object(le.a)(Ae,(function(e){return e.context})),Ie=Object(le.a)(Ae,(function(e){return e.isLoggedIn})),De=Object(le.a)(Ae,(function(e){return e.noteKeys})),Ue=Object(le.a)(Ae,(function(e){return e.noteValues})),Le=Object(le.a)(Ae,(function(e){return e.noteStatuses})),Pe=Ke.actions,Re=Pe.initializeContext,Ve=(Pe.logout,Ke.reducer),Be=n(49),Te=Object(de.c)({name:"workspace",initialState:{activeKey:""},reducers:{updateActiveKey:function(e,t){return Object(d.a)(Object(d.a)({},e),{},{activeKey:t.payload})}}}),Fe=Object(le.a)((function(e){return e.workspace}),(function(e){return e.activeKey})),ze=Te.actions.updateActiveKey,Me=Te.reducer,We=Object(de.c)({name:"draft",initialState:{drafts:{},newDraft:!1},reducers:{newDraft:function(e,t){var n=t.payload,r=n.key,a=n.note,c=e.drafts[r];return Object(d.a)(Object(d.a)({},e),{},{key:r,drafts:Object(d.a)(Object(d.a)({},e.drafts),{},Object(C.a)({},r,c||Object(d.a)(Object(d.a)({},a),{},{isDirty:!1}))),newDraft:!0})},newDraftUpdatedInternal:function(e){return Object(d.a)(Object(d.a)({},e),{},{newDraft:!1})},updateTitle:function(e,t){var n=t.payload;return Object(d.a)(Object(d.a)({},e),{},{drafts:Object(d.a)(Object(d.a)({},e.drafts),{},Object(C.a)({},e.key,Object(d.a)(Object(d.a)({},e.drafts[e.key]),{},{title:n,isDirty:!0})))})},updateBody:function(e,t){var n=t.payload;return Object(d.a)(Object(d.a)({},e),{},{drafts:Object(d.a)(Object(d.a)({},e.drafts),{},Object(C.a)({},e.key,Object(d.a)(Object(d.a)({},e.drafts[e.key]),{},{body:n,isDirty:!0})))})},draftSaved:function(e,t){var n=t.payload,r=n.key,a=n.note;return Object(d.a)(Object(d.a)({},e),{},{drafts:Object(d.a)(Object(d.a)({},e.drafts),{},Object(C.a)({},r,Object(d.a)(Object(d.a)({},e.drafts[r]),{},{lastUpdatedAt:a.lastUpdatedAt,isDirty:!1})))})}}}),_e=function(e){return e.draft},qe=(Object(le.a)(_e,(function(e){return e.key})),We.actions),He=qe.newDraft,Je=qe.newDraftUpdatedInternal,Ge=qe.updateTitle,Qe=qe.updateBody,Xe=qe.draftSaved,Ye=We.reducer,Ze="uninitialized",$e="requestingCredentials",et="decrypting",tt="completeLoggedIn",nt="completeAnon",rt={phase:Ze,value:"",error:"",contextData:"",context:null},at=Object(de.b)("login/submit",function(){var e=Object(p.a)(i.a.mark((function e(t,n){var r,a,c,s,u,o,p,d;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.getState,a=n.dispatch,c=n.rejectWithValue,s=ut(r()),u=s.value,o=s.contextData,p=st.actions.decrypt,a(p()),e.prev=4,e.next=7,_(o,u);case 7:d=e.sent,e.next=13;break;case 10:return e.prev=10,e.t0=e.catch(4),e.abrupt("return",c("Invalid password."));case 13:return e.prev=13,e.next=16,se(d);case 16:d=e.sent,e.next=22;break;case 19:return e.prev=19,e.t1=e.catch(13),e.abrupt("return");case 22:return a(Re(d)),e.next=25,a(ct());case 25:return e.abrupt("return");case 26:case"end":return e.stop()}}),e,null,[[4,10],[13,19]])})));return function(t,n){return e.apply(this,arguments)}}()),ct=Object(de.b)("login/loadAll",function(){var e=Object(p.a)(i.a.mark((function e(t,n){var r,a,c,s,u,o,p,d,l,b,f;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.getState,a=n.dispatch,c=Ee(r()),s=c.keyNames,u=Object(Be.a)(s),e.prev=3,u.s();case 5:if((o=u.n()).done){e.next=11;break}return p=o.value,e.next=9,a(Se(p));case 9:e.next=5;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(3),u.e(e.t0);case 16:return e.prev=16,u.f(),e.finish(16);case 19:d=Ue(r()),l=Jt(s,d),b=Object(N.a)(l,1),(f=b[0])&&(a(ze(f)),a(He({key:f,note:d[f]})));case 23:case"end":return e.stop()}}),e,null,[[3,13,16,19]])})));return function(t,n){return e.apply(this,arguments)}}()),st=Object(de.c)({name:"login",initialState:rt,reducers:{initLogin:function(e,t){var n=localStorage.getItem("_context");return n?Object(d.a)(Object(d.a)({},e),{},{phase:$e,contextData:n,value:"",error:""}):Object(d.a)(Object(d.a)({},e),{},{phase:nt,context:{url:"http://localhost",userId:void 0,keys:{signing:void 0,encryption:void 0},keyNames:[],plaintextValues:{}},error:""})},decrypt:function(e){return Object(d.a)(Object(d.a)({},e),{},{phase:et})},updatePasswordLogin:function(e,t){var n=t.payload;return Object(d.a)(Object(d.a)({},e),{},{value:n})}},extraReducers:(B={},Object(C.a)(B,at.rejected,(function(e,t){var n=t.payload;return Object(d.a)(Object(d.a)({},e),{},{phase:$e,error:n})})),Object(C.a)(B,at.fulfilled,(function(){return{phase:tt}})),B)}),ut=function(e){return e.login},ot=st.actions,it=ot.initLogin,pt=ot.updatePasswordLogin,dt=st.reducer,lt="requestingCredentials",bt="registering",ft="completeRegistration",jt={phase:"uninitialized",value:"",valueConfirmation:"",error:""},ht=Object(de.b)("register/submit",function(){var e=Object(p.a)(i.a.mark((function e(t,n){var r,a,c,s,u,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.getState,a=n.dispatch,c=n.rejectedWithValue,e.prev=1,e.next=4,ae({url:"http://localhost",userId:void 0,keys:{signing:void 0,encryption:void 0},keyNames:[],plaintextValues:{}});case 4:s=e.sent,e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(1),e.abrupt("return",c(e.t0));case 10:return a(Re(s)),u=Ot(r()),o=u.value,e.next=14,a(ke(o));case 14:return e.abrupt("return",{context:s});case 15:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t,n){return e.apply(this,arguments)}}()),xt=Object(de.c)({name:"register",initialState:jt,reducers:{initRegister:function(e,t){return Object(d.a)(Object(d.a)({},e),{},{phase:lt})},updatePasswordRegister:function(e,t){var n=t.payload;return Object(d.a)(Object(d.a)({},e),{},{value:n})},updatePasswordConfirmationRegister:function(e,t){var n=t.payload;return Object(d.a)(Object(d.a)({},e),{},{valueConfirmation:n})}},extraReducers:(T={},Object(C.a)(T,ht.pending,(function(e){return Object(d.a)(Object(d.a)({},e),{},{phase:bt})})),Object(C.a)(T,ht.rejected,(function(e,t){return{phase:lt,error:t}})),Object(C.a)(T,ht.fulfilled,(function(){return{phase:ft}})),T)}),Ot=function(e){return e.register},vt=xt.actions,yt=vt.initRegister,wt=vt.updatePasswordRegister,gt=vt.updatePasswordConfirmationRegister,kt=xt.reducer,mt=Object(k.b)((function(e){return{login:ut(e),register:Ot(e),context:Ee(e),isLoggedIn:Ie(e)}}),(function(e){return{dispatchLoginInit:function(){return e(it())},dispatchUpdateLoginPassword:function(t){return e(pt(t))},dispatchSubmitLoginPassword:function(){return e(at())},dispatchRegisterInit:function(){return e(yt())},dispatchUpdateRegisterPassword:function(t){return e(wt(t))},dispatchUpdateRegisterPasswordConfirmation:function(t){return e(gt(t))},dispatchSubmitRegisterPassword:function(){return e(ht())}}}))((function(e){var t=e.isLoggedIn,n=e.login,c=e.register,s=e.dispatchLoginInit,u=e.dispatchUpdateLoginPassword,o=e.dispatchSubmitLoginPassword,i=e.dispatchRegisterInit,p=e.dispatchUpdateRegisterPassword,d=e.dispatchUpdateRegisterPasswordConfirmation,l=e.dispatchSubmitRegisterPassword,k=e.dispatchLogout,m=n.phase,S=n.value,C=n.error,N=c.phase,K=c.value,A=c.valueConfirmation,E=c.error;Object(a.useEffect)((function(){return s()}),[s]);var I=Object(a.useRef)(null);Object(a.useEffect)((function(){return I.current&&I.current.focus()}));var D=K&&A&&K===A&&K.length>=8;return Object(r.jsxs)("div",{children:[Object(r.jsxs)(w.a,{centered:!0,backdrop:"static",show:m===$e,children:[Object(r.jsx)(w.a.Header,{children:Object(r.jsx)(w.a.Title,{children:"Please enter your password."})}),Object(r.jsxs)(w.a.Body,{children:[Object(r.jsx)(g.a.Control,{ref:I,size:"sm",type:"password",placeholder:"Password",value:S,onChange:function(e){return u(e.target.value)}}),C&&Object(r.jsx)("div",{className:"pt-4",children:Object(r.jsx)(h.a,{variant:"danger",children:C})})]}),Object(r.jsx)(w.a.Footer,{children:Object(r.jsx)(v.a,{variant:"primary",onClick:function(){return o()},children:"Login"})})]}),Object(r.jsxs)(w.a,{centered:!0,backdrop:"static",show:N===lt,children:[Object(r.jsx)(w.a.Header,{children:Object(r.jsx)(w.a.Title,{children:"Please enter a secure password."})}),Object(r.jsxs)(w.a.Body,{children:[Object(r.jsx)(g.a.Control,{size:"sm",type:"password",placeholder:"Password",value:K,onChange:function(e){return p(e.target.value)}}),Object(r.jsx)("div",{className:"p-2"}),Object(r.jsx)(g.a.Control,{size:"sm",type:"password",placeholder:"Re-enter Password",value:A,onChange:function(e){return d(e.target.value)}}),E&&Object(r.jsx)("div",{className:"pt-4",children:Object(r.jsx)(h.a,{variant:"danger",children:E})})]}),Object(r.jsx)(w.a.Footer,{children:Object(r.jsx)(v.a,{disabled:!D,variant:"primary",onClick:function(){return l()},children:"Register"})})]}),Object(r.jsx)(w.a,{centered:!0,backdrop:"static",show:m===et||N===bt,children:Object(r.jsx)(w.a.Body,{children:Object(r.jsxs)(b.a,{children:[Object(r.jsx)(f.a,{children:Object(r.jsx)(j.a,{children:m===m.decrypting?Object(r.jsx)("p",{className:"text-center lead",children:"Decrypting..."}):Object(r.jsx)("p",{className:"text-center lead",children:"Generating Keys..."})})}),Object(r.jsxs)(f.a,{children:[Object(r.jsx)(j.a,{}),Object(r.jsx)(j.a,{md:"auto",children:Object(r.jsx)("img",{src:"./infinity.gif",alt:"Loading..."})}),Object(r.jsx)(j.a,{})]})]})})}),Object(r.jsxs)(O.a,{bg:"light",expand:"lg",children:[Object(r.jsxs)(O.a.Brand,{children:[Object(r.jsx)("img",{alt:"Logo",width:"44",style:{marginRight:"20px "},src:"logo.png"}),"Nk Notes"]}),Object(r.jsx)(O.a.Toggle,{"aria-controls":"basic-navbar-nav"}),Object(r.jsx)(O.a.Collapse,{id:"basic-navbar-nav",className:"justify-content-end",children:t?Object(r.jsxs)(x.a,{children:[Object(r.jsx)(O.a.Text,{children:"Signed in.\xa0\xa0"}),Object(r.jsx)(v.a,{variant:"outline-secondary",onClick:function(){return k()},children:"Logout"})]}):m===et||N===bt?Object(r.jsx)(x.a,{children:Object(r.jsx)(y.a,{animation:"border",size:"sm",role:"status"})}):m===nt||m===Ze?Object(r.jsx)(x.a,{children:Object(r.jsx)(v.a,{className:"mr-sm-2",onClick:function(){return i()},children:"Register"})}):m===$e||N===lt?Object(r.jsx)(r.Fragment,{}):void 0})]})]})})),St=n(111),Ct=n(104),Nt=n(67),Kt=n(29),At=n(30),Et=Object(de.c)({name:"files",initialState:{query:"",searchFocus:0},reducers:{updateQuery:function(e,t){var n=t.payload;return Object(d.a)(Object(d.a)({},e),{},{query:n})},focusSearch:function(e){return Object(d.a)(Object(d.a)({},e),{},{searchFocus:e.searchFocus+1})}}}),It=function(e){return e.files},Dt=Object(le.a)(It,(function(e){return e.query})),Ut=Object(le.a)(It,(function(e){return e.searchFocus})),Lt=Et.actions,Pt=Lt.updateQuery,Rt=Lt.focusSearch,Vt=Et.reducer,Bt=n(61),Tt=function(e){return"Escape"===e.code&&!e.ctrlKey&&!e.metaKey&&(e.target.blur(),!0)},Ft=Object(k.b)((function(e){return{query:Dt(e),searchFocus:Ut(e)}}),(function(e){return{dispatchUpdateQuery:function(t){return e(Pt(t))}}}))((function(e){var t=e.files,n=void 0===t?[]:t,c=e.activeNote,s=e.query,u=e.searchFocus,o=e.dispatchUpdateQuery,d=e.onCreateNote,l=e.onNoteSelected,h=Object(a.useState)(!1),x=Object(N.a)(h,2),O=x[0],w=x[1],g=Object(a.useRef)(null);Object(a.useEffect)((function(){g.current&&g.current.focus()}),[u]);for(var k=[Object(r.jsx)(St.a.Item,{children:Object(r.jsx)(v.a,{variant:"outline-success",onClick:Object(p.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return w(!0),e.next=3,d();case 3:w(!1);case 4:case"end":return e.stop()}}),e)}))),children:O?Object(r.jsx)(y.a,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true"}):Object(r.jsx)("span",{children:"+ New Note"})})},"__new__")],m=function(e,t){var a=n[e],s=a.key,u=a.name,o=a.lastUpdatedAt,i=a.status,p=new Date;p.setTime(o);var d=void 0;switch(i){case we:d=Object(r.jsx)(Kt.a,{icon:At.b});break;case xe:d=Object(r.jsx)(y.a,{animation:"border",size:"sm",as:"span"});break;case he:d=Object(r.jsx)(Kt.a,{icon:At.c});break;default:d=Object(r.jsx)(b.a,{children:Object(r.jsxs)(f.a,{xs:1,md:1,lg:2,xl:2,children:[Object(r.jsx)(j.a,{children:Object(r.jsx)("span",{children:u})}),Object(r.jsx)(j.a,{children:Object(r.jsx)("span",{children:Object(r.jsx)("small",{children:p.toLocaleDateString()})})})]})})}k.push(Object(r.jsx)(St.a.Item,{action:!0,active:c===s,onClick:function(){return l(s)},children:d},e))},S=0,C=n.length;S<C;S++)m(S);return Object(r.jsxs)("div",{children:[Object(r.jsx)("div",{className:"pb-4",children:Object(r.jsxs)(Ct.a,{children:[Object(r.jsx)(Nt.a,{ref:g,type:"text",placeholder:"Search",size:"lg",value:s,onChange:function(e){return o(e.target.value)},onKeyDown:Tt}),Object(r.jsx)(Ct.a.Append,{children:Object(r.jsx)(v.a,{variant:"outline-secondary",onClick:function(){return o("")},children:Object(r.jsx)(Kt.a,{icon:At.e})})})]})}),Object(r.jsx)(St.a,{children:k})]})})),zt=n(105),Mt=n(106),Wt=n(69),_t=function(e){var t=e.hotkey,n=t.key,r=t.action;return Object(Bt.a)("command+".concat(n,", ctrl+").concat(n),(function(e){e.preventDefault(),r()}),{},[n,r]),null},qt=Object(k.b)((function(e){return{draft:_e(e),isSaving:Le(e)[Fe(e)]===ve}}),(function(e){return{dispatchUpdateTitle:function(t){return e(Ge(t))},dispatchUpdateBody:function(t){return e(Qe(t))},dispatchNewDraftInternal:function(){return e(Je())},dispatchSearchFocus:function(){return e(Rt())}}}))((function(e){var t=e.onSave,n=e.onDuplicate,c=e.onNew,s=e.onDelete,u=e.isSaving,o=e.draft,d=o.key,l=o.drafts,b=o.newDraft,f=e.dispatchNewDraftInternal,j=e.dispatchUpdateTitle,h=e.dispatchUpdateBody,x=e.dispatchSearchFocus,O=l[d]||{},k=O.title,m=O.body,S=O.lastUpdatedAt,C=function(){var e=Object(p.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t({key:d,title:k,body:m});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),K=function(){var e=Object(p.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n(d);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),A=function(){var e=Object(p.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),E=function(){var e=Object(p.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s(d);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),I=Object(a.useRef)(null),D=Object(a.useRef)(null),U=Object(a.useState)(!1),L=Object(N.a)(U,2),P=L[0],R=L[1],V=[{key:"s",action:C},{key:"d",action:K},{key:"n",action:A},{key:"f",action:x},{key:"e",action:function(){return I.current.getInstance().focus()}},{key:"h",action:function(){return D.current.focus()}},{key:"m",action:function(){I.current&&(I.current.getInstance().isMarkdownMode()?I.current.getInstance().changeMode("wysiwyg"):I.current.getInstance().changeMode("markdown"))}},{key:"Delete",action:function(){return R(!0)}},{key:"Backspace",action:function(){return R(!0)}}],B=V.map((function(e,t){return Object(r.jsx)(_t,{hotkey:e},t)}));if(Object(a.useEffect)((function(){b&&(I.current&&(I.current.getInstance().setMarkdown(m),I.current.getInstance().focus()),f())})),!d)return null;var T=new Date;return T.setTime(S),Object(r.jsxs)("div",{children:[B,Object(r.jsxs)(w.a,{show:P,onHide:function(){return R(!1)},children:[Object(r.jsx)(w.a.Header,{children:"Confirm"}),Object(r.jsx)(w.a.Body,{children:Object(r.jsx)("p",{children:"Are you sure you want to permanently delete '".concat(k,"'? There will be no way to recover this note.")})}),Object(r.jsxs)(w.a.Footer,{children:[Object(r.jsx)(v.a,{variant:"secondary",onClick:function(){return R(!1)},children:"Close"}),Object(r.jsx)(v.a,{variant:"danger",onClick:Object(p.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E();case 2:R(!1);case 3:case"end":return e.stop()}}),e)}))),children:"Delete"})]})]}),Object(r.jsx)("div",{className:"pb-4",children:Object(r.jsx)(g.a.Control,{ref:D,size:"lg",type:"text",placeholder:"Title",value:k,onChange:function(e){return j(e.target.value)},onKeyDown:Tt})}),Object(r.jsx)("div",{className:"pb-4",children:Object(r.jsxs)(zt.a,{className:"justify-content-between",children:[Object(r.jsxs)(Mt.a,{children:[Object(r.jsx)(v.a,{onClick:C,children:u?Object(r.jsx)(y.a,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true"}):Object(r.jsx)(Kt.a,{icon:At.d})}),Object(r.jsx)(v.a,{variant:"outline-secondary",onClick:K,children:Object(r.jsx)(Kt.a,{icon:At.a})})]}),Object(r.jsx)("p",{className:"mb-0 mt-2",children:Object(r.jsxs)("small",{children:["Last saved ",T.toLocaleString("en-US")]})}),Object(r.jsx)(Mt.a,{children:Object(r.jsx)(v.a,{variant:"outline-danger",onClick:function(){return R(!0)},children:Object(r.jsx)(Kt.a,{icon:At.f})})})]})}),Object(r.jsx)(Wt.Editor,{ref:I,initialValue:m,placeholder:"Start writing",previewStyle:"vertical",height:"600px",initialEditType:"wysiwyg",useCommandShortcut:!1,usageStatistics:!1,onChange:function(){var e=I.current.getInstance().getMarkdown();m!==e&&h(e)},onKeydown:function(){var e=Object(p.a)(i.a.mark((function e(t){var n,r,a,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.data.key,!(t.data.metaKey&&!t.data.ctrlKey||t.data.ctrlKey&&!t.data.metaKey)){e.next=23;break}r=Object(Be.a)(V),e.prev=3,r.s();case 5:if((a=r.n()).done){e.next=13;break}if((c=a.value).key!==n){e.next=11;break}return t.data.preventDefault(),e.next=11,c.action();case 11:e.next=5;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(3),r.e(e.t0);case 18:return e.prev=18,r.f(),e.finish(18);case 21:e.next=24;break;case 23:"Escape"===n&&I.current.getInstance().blur();case 24:case"end":return e.stop()}}),e,null,[[3,15,18,21]])})));return function(t){return e.apply(this,arguments)}}()})]})})),Ht=n(71),Jt=function(e,t){var n=Object(l.a)(e);return n.sort((function(e,n){var r=t[e],a=t[n];return r?a?a.lastUpdatedAt-r.lastUpdatedAt:-1:1})),n};var Gt=Object(k.b)((function(e){return{login:ut(e),context:Ee(e),isLoggedIn:Ie(e),activeKey:Fe(e),noteKeys:De(e),noteValues:Ue(e),noteStatuses:Le(e),draft:_e(e),query:Dt(e)}}),(function(e){return{dispatchNewNote:function(t){return e(me({from:t}))},dispatchLoadNote:function(t){return e(Se(t))},dispatchUpdateNote:function(){var t=Object(p.a)(i.a.mark((function t(n){var r,a,c,s,u;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.key,a=n.note,t.next=3,e(Ce({key:r,note:a}));case 3:return c=t.sent,t.prev=4,t.next=7,Object(de.d)(c);case 7:s=t.sent,t.next=13;break;case 10:return t.prev=10,t.t0=t.catch(4),t.abrupt("return",c);case 13:return u=s.note,e(Xe({note:u,key:r})),t.abrupt("return",c);case 16:case"end":return t.stop()}}),t,null,[[4,10]])})));return function(e){return t.apply(this,arguments)}}(),dispatchDeleteNote:function(){var t=Object(p.a)(i.a.mark((function t(n){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e(Ne(n));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),dispatchUpdateActiveKey:function(t){var n=t.key,r=t.note;e(ze(n)),e(He({key:n,note:r}))}}}))((function(e){var t,n=e.context,c=e.isLoggedIn,s=e.activeKey,u=e.dispatchUpdateActiveKey,o=e.noteKeys,l=e.noteValues,x=e.noteStatuses,O=e.draft,v=e.query,y=e.dispatchNewNote,w=e.dispatchLoadNote,g=e.dispatchUpdateNote,k=e.dispatchDeleteNote,m=Object(a.useRef)(new Ht.a([],{includeScore:!0,ignoreLocation:!0,shouldSort:!0,keys:["title","body"]}));if(Object(a.useEffect)((function(){var e=o.map((function(e){return Object(d.a)({key:e},l[e]||{})}));m.current.setCollection(e)}),[x,o,l]),v){var S=m.current.search(v);t=S.map((function(e){return e.item.key}))}else t=Jt(o,l);var C=t.map((function(e){var t=x[e],n=(O.drafts[e]||{}).isDirty,r=(l[e]||{}).lastUpdatedAt,a=l[e];if(a){var c=a.title;return{key:e,name:"".concat(c).concat(n?"*":""),status:t,lastUpdatedAt:r}}return{key:e,name:e,status:t,lastUpdatedAt:r}})),N=function(){var e=Object(p.a)(i.a.mark((function e(t){var n,r,a,c,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y(t);case 2:return n=e.sent,e.prev=3,e.next=6,Object(de.d)(n);case 6:r=e.sent,e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(3),e.abrupt("return");case 12:c=(a=r).key,s=a.note,u({key:c,note:s});case 14:case"end":return e.stop()}}),e,null,[[3,9]])})));return function(t){return e.apply(this,arguments)}}(),K=function(){var e=Object(p.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g({key:s,note:be({title:O.drafts[s].title,body:O.drafts[s].body})});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),A=function(){var e=Object(p.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=fe(je(l[t]))).title+=" (Copy)",e.next=4,N(n);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),E=function(){var e=Object(p.a)(i.a.mark((function e(){var n,r,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k(s);case 2:n=0,r=t.length;case 3:if(!(n<r)){e.next=12;break}if((a=t[n])===s){e.next=9;break}return e.next=8,u({key:a,note:l[a]});case 8:return e.abrupt("return",e.sent);case 9:n++,e.next=3;break;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),I=function(){var e=Object(p.a)(i.a.mark((function e(t){var n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=l[t]){e.next=13;break}return e.next=4,w(t);case 4:r=e.sent,e.prev=5,r=Object(de.d)(r),n=r.note,e.next=13;break;case 10:return e.prev=10,e.t0=e.catch(5),e.abrupt("return");case 13:u({key:t,note:n});case 14:case"end":return e.stop()}}),e,null,[[5,10]])})));return function(t){return e.apply(this,arguments)}}();return Object(r.jsxs)(b.a,{className:"h-100 mh-100",children:[Object(r.jsx)(mt,{context:n}),c&&Object(r.jsxs)(f.a,{className:"p-2 h-100",children:[Object(r.jsx)(j.a,{className:"p-2",xs:4,children:Object(r.jsx)(Ft,{files:C,activeNote:s,onCreateNote:N,onNoteSelected:I})}),Object(r.jsx)(j.a,{className:"p-2 h-100",children:Object(r.jsx)(qt,{onSave:K,onDuplicate:A,onDelete:E})})]}),!c&&Object(r.jsx)(f.a,{className:"pt-5",children:Object(r.jsx)(j.a,{children:Object(r.jsx)(h.a,{variant:"dark",children:"Register or login to continue."})})})]})})),Qt=(n(96),n(43)),Xt=n(72),Yt=Object(de.a)({reducer:{nk:Ve,workspace:Me,draft:Ye,files:Vt,login:dt,register:kt},middleware:[Qt.a,Xt.a]});u.a.render(Object(r.jsx)(c.a.StrictMode,{children:Object(r.jsx)(k.a,{store:Yt,children:Object(r.jsx)(Gt,{})})}),document.getElementById("root"))}},[[97,1,2]]]);
//# sourceMappingURL=main.86e7c2a9.chunk.js.map