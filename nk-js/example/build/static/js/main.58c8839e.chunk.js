(this.webpackJsonpexample=this.webpackJsonpexample||[]).push([[0],{39:function(e,t,n){},41:function(e,t,n){},54:function(e,t,n){"use strict";n.r(t);var r=n(4),a=n(0),c=n.n(a),s=n(12),o=n.n(s),u=(n(39),n(6)),i=n.n(u),p=n(8),l=n(15),d=(n(41),n(58)),x=n(59),f=n(31),h=n(63),b=n(61),v=n(62),y=n(60),j=n(18),w=n(29),O=n(9),g={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",decodeArrayBuffer:function(e){var t=e.length/4*3,n=new ArrayBuffer(t);return this.decode(e,n),n},removePaddingChars:function(e){return 64==this._keyStr.indexOf(e.charAt(e.length-1))?e.substring(0,e.length-1):e},decode:function(e,t){e=this.removePaddingChars(e),e=this.removePaddingChars(e);var n,r,a,c,s,o,u,i=parseInt(e.length/4*3,10),p=0,l=0;for(n=t?new Uint8Array(t):new Uint8Array(i),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,""),p=0;p<i;p+=3)r=this._keyStr.indexOf(e.charAt(l++))<<2|(s=this._keyStr.indexOf(e.charAt(l++)))>>4,a=(15&s)<<4|(o=this._keyStr.indexOf(e.charAt(l++)))>>2,c=(3&o)<<6|(u=this._keyStr.indexOf(e.charAt(l++))),n[p]=r,64!=o&&(n[p+1]=a),64!=u&&(n[p+2]=c);return n}},k=function(e){return btoa(String.fromCharCode.apply(null,e))},m=function(e){return k(new Uint8Array(e))},S=function(e){return crypto.subtle.importKey("raw",(new TextEncoder).encode(e),{name:"PBKDF2"},!1,["deriveBits","deriveKey"])},C=function(e,t,n){return crypto.subtle.deriveKey({name:"PBKDF2",salt:t,iterations:1e5,hash:"SHA-256"},e,{name:n,length:256},!0,["wrapKey","unwrapKey"])},N=function(){var e=Object(p.a)(i.a.mark((function e(t,n){var r,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.bytes,t.salt,t.iv,a=g.decodeArrayBuffer(r),e.abrupt("return",crypto.subtle.importKey("pkcs8",a,{name:"RSASSA-PKCS1-v1_5",modulusLength:4096,publicExponent:new Uint8Array([1,0,1]),hash:"SHA-512"},!0,["sign","verify"]));case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),A=function(){var e=Object(p.a)(i.a.mark((function e(t,n){var r,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,crypto.subtle.exportKey("pkcs8",t);case 2:return r=e.sent,a={bytes:m(r)},e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),K=function(){var e=Object(p.a)(i.a.mark((function e(t,n){var r,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,crypto.subtle.exportKey("spki",t);case 2:return r=e.sent,a={bytes:m(r)},e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),E=function(){var e=Object(p.a)(i.a.mark((function e(t,n){var r,a,c,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S(n);case 2:return r=e.sent,a=crypto.getRandomValues(new Uint8Array(16)),e.next=6,C(r,a,"AES-KW");case 6:return c=e.sent,e.next=9,crypto.subtle.wrapKey("raw",t,c,"AES-KW");case 9:return s=e.sent,e.abrupt("return",{salt:k(a),bytes:m(s)});case 11:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),I=function(){var e=Object(p.a)(i.a.mark((function e(t,n){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=JSON.parse(JSON.stringify(t))).keys.signing={},e.prev=2,e.next=5,A(t.keys.signing.privateKey,n);case 5:r.keys.signing.privateKey=e.sent,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),console.log("Could not serialize private key.",e.t0);case 11:return e.prev=11,e.next=14,K(t.keys.signing.publicKey,n);case 14:r.keys.signing.publicKey=e.sent,e.next=20;break;case 17:e.prev=17,e.t1=e.catch(11),console.log("Could not serialize public key.",e.t1);case 20:return e.prev=20,e.next=23,E(t.keys.encryption,n);case 23:r.keys.encryption=e.sent,e.next=29;break;case 26:e.prev=26,e.t2=e.catch(20),console.log("Could not serialize encryption key.",e.t2);case 29:return e.abrupt("return",JSON.stringify(r));case 30:case"end":return e.stop()}}),e,null,[[2,8],[11,17],[20,26]])})));return function(t,n){return e.apply(this,arguments)}}(),P=function(){var e=Object(p.a)(i.a.mark((function e(t,n){var r,a,c,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=JSON.parse(t),a=r.keys,c=a.signing,s=c.privateKey,c.publicKey,a.encryption,r.keys={signing:{}},e.prev=3,e.next=6,N(s,n);case 6:r.keys.signing.privateKey=e.sent,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(3),console.error("Could not create private key: ".concat(e.t0,"."));case 12:return e.abrupt("return",r);case 13:case"end":return e.stop()}}),e,null,[[3,9]])})));return function(t,n){return e.apply(this,arguments)}}(),U=function(){var e=Object(p.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:4096,publicExponent:new Uint8Array([1,0,1]),hash:"SHA-512"},!0,["sign","verify"]);case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),B=function(){var e=Object(p.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),_=function(){var e=Object(p.a)(i.a.mark((function e(t){var n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,crypto.subtle.exportKey("spki",t);case 3:n=e.sent,e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(0),new Error("Could not export public key: ".concat(e.t0,"."));case 9:return r=m(n).match(/.{1,64}/g).join("\n"),e.abrupt("return","-----BEGIN PUBLIC KEY-----\n".concat(r,"\n-----END PUBLIC KEY-----"));case 11:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),J=function(e,t,n){return Object(O.a)(Object(O.a)({},e),{},{keys:{signing:t,encryption:n}})},L=function(e,t){return Object(O.a)(Object(O.a)({},e),{},{keyNames:Object(w.a)(new Set(t))})},R=function(e,t){return Object(O.a)(Object(O.a)({},e),{},{userId:t})},T=function(e,t,n){return L(Object(O.a)(Object(O.a)({},e),{},{values:Object(O.a)(Object(O.a)({},e.values),{},Object(j.a)({},t,n))}),[].concat(Object(w.a)(e.keyNames),[t]))},z=function(e){return void 0!==e.userId},M=function(){var e=Object(p.a)(i.a.mark((function e(t){var n,r,a,c,s,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,U();case 3:n=e.sent,e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(0),new Error("Could not generate signing key pair: ".concat(e.t0,"."));case 9:return e.prev=9,e.next=12,B();case 12:r=e.sent,e.next=18;break;case 15:throw e.prev=15,e.t1=e.catch(9),new Error("Could not generate encryption key: ".concat(e.t1,"."));case 18:return e.next=20,_(n.publicKey);case 20:return a=e.sent,(c=new Headers).append("Content-Type","text/plain"),e.prev=23,e.next=26,fetch("".concat(t.url,"/user"),{method:"post",body:a,headers:c});case 26:return o=e.sent,e.next=29,o.json();case 29:s=e.sent,e.next=35;break;case 32:throw e.prev=32,e.t2=e.catch(23),e.t2;case 35:return e.abrupt("return",J(R(t,s.userId),n,r));case 36:case"end":return e.stop()}}),e,null,[[0,6],[9,15],[23,32]])})));return function(t){return e.apply(this,arguments)}}(),H=function(){var e=Object(p.a)(i.a.mark((function e(t,n,r){var a,c,s,o,u,p,l,d;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("".concat(t.url,"/proof/").concat(t.userId),{method:"post"});case 3:return c=e.sent,e.next=6,c.json();case 6:a=e.sent,e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(0),new Error("Could not fetch proof: ".concat(e.t0,"."));case 12:if(o=(s=a).success,u=s.error,p=s.value,o){e.next=15;break}throw new Error("Could not fetch proof: ".concat(u,"."));case 15:return e.next=17,crypto.subtle.sign({name:"RSASSA-PKCS1-v1_5",saltLength:32},t.keys.signing.privateKey,(new TextEncoder).encode(p));case 17:return l=e.sent,d=m(l),r||(r={}),r.headers||(r.headers={}),r.headers["X-Nk-Proof"]=p,r.headers["X-Nk-Proof-Sig"]=d,e.next=25,fetch(n,r);case 25:return e.abrupt("return",e.sent);case 26:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,n,r){return e.apply(this,arguments)}}(),D=function(){var e=Object(p.a)(i.a.mark((function e(t){var n,r,a,c,s,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,H(t,"".concat(t.url,"/data/").concat(t.userId));case 3:return r=e.sent,e.next=6,r.json();case 6:n=e.sent,e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(0),new Error("Could not get keys: ".concat(e.t0,"."));case 12:if(c=(a=n).success,s=a.error,o=a.keys,c){e.next=15;break}throw new Error("Could not get keys: ".concat(s,"."));case 15:return e.abrupt("return",L(t,o));case 16:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}(),G=function(){var e=Object(p.a)(i.a.mark((function e(t,n){var r,a,c,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new TextEncoder,a=r.encode(n),e.prev=2,e.next=5,crypto.subtle.encrypt({name:"AES-GCM",iv:window.crypto.getRandomValues(new Uint8Array(12)),tagLength:128},t.keys.encryption,a);case 5:c=e.sent,e.next=11;break;case 8:throw e.prev=8,e.t0=e.catch(2),new Error("Could not encrypt value: ".concat(e.t0,"."));case 11:return e.prev=11,e.next=14,window.crypto.subtle.sign({name:"RSASSA-PKCS1-v1_5"},t.keys.signing.privateKey,new Uint8Array(c));case 14:s=e.sent,e.next=20;break;case 17:throw e.prev=17,e.t1=e.catch(11),new Error("Could not sign value: ".concat(e.t1,"."));case 20:return e.abrupt("return",{value:m(c),signature:m(s)});case 21:case"end":return e.stop()}}),e,null,[[2,8],[11,17]])})));return function(t,n){return e.apply(this,arguments)}}(),V=function(){var e=Object(p.a)(i.a.mark((function e(t,n,r){var a,c,s,o,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,G(t,r);case 2:return a=e.sent,c=a.value,s=a.signature,e.prev=5,e.next=8,fetch("".concat(t.url,"/data/").concat(t.userId),{method:"post",body:JSON.stringify({Key:n,Payload:c,Sig:s}),headers:{"Content-Type":"application/json",Accept:"application/json"}});case 8:return u=e.sent,e.next=11,u.json();case 11:o=e.sent,e.next=17;break;case 14:throw e.prev=14,e.t0=e.catch(5),new Error("Could not create data: ".concat(e.t0,"."));case 17:if(o.success){e.next=19;break}throw new Error("Could not create data: server returned false.");case 19:return e.abrupt("return",T(t,n,r));case 20:case"end":return e.stop()}}),e,null,[[5,14]])})));return function(t,n,r){return e.apply(this,arguments)}}(),F=function(){var e=Object(p.a)(i.a.mark((function e(t,n,r){var a,c,s,o,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,G(t,r);case 2:return a=e.sent,c=a.value,s=a.signature,e.prev=5,e.next=8,fetch("".concat(t.url,"/data/").concat(t.userId,"/").concat(n),{method:"put",body:JSON.stringify({Key:n,Payload:c,Sig:s}),headers:{"Content-Type":"application/json",Accept:"application/json"}});case 8:return u=e.sent,e.next=11,u.json();case 11:o=e.sent,e.next=17;break;case 14:throw e.prev=14,e.t0=e.catch(5),new Error("Could not update data: ".concat(e.t0,"."));case 17:if(o.success){e.next=19;break}throw new Error("Could not update data: server returned false.");case 19:return e.abrupt("return",T(t,n,r));case 20:case"end":return e.stop()}}),e,null,[[5,14]])})));return function(t,n,r){return e.apply(this,arguments)}}(),W=(n(42),n(43),n(30)),X=n(23),Y=n(24),Z=function(e){return JSON.stringify(e)},q=function(e){var t=e.context,n=e.onCreateUser,a=e.onLogin;return Object(r.jsx)(d.a,{children:Object(r.jsxs)(x.a,{children:[Object(r.jsx)(f.a,{children:z(t)?Object(r.jsx)("p",{children:"Logged in. UserId: '".concat(t.userId,"'.")}):Object(r.jsx)(h.a,{onClick:function(){return n()},children:"Create Account"})}),Object(r.jsx)(f.a,{children:!z(t)&&Object(r.jsx)(h.a,{disabled:!0,onClick:function(){return a("111111")},children:"Login"})})]})})},Q=function(e){var t=e.activeNote,n=e.note,c=void 0===n?{}:n,s=e.onSave,o=c.title,u=c.body,v=Object(a.useRef)(null),y=Object(a.useState)(o),j=Object(l.a)(y,2),w=j[0],O=j[1],g=Object(a.useState)(u),k=Object(l.a)(g,2),m=k[0],S=k[1];return t?Object(r.jsxs)(d.a,{className:"p-2",children:[Object(r.jsx)(x.a,{className:"p-2",children:Object(r.jsx)(f.a,{children:Object(r.jsx)(h.a,{onClick:Object(p.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",s({title:w,body:m}));case 1:case"end":return e.stop()}}),e)}))),children:Object(r.jsx)(X.a,{icon:Y.c})})})}),Object(r.jsx)(x.a,{className:"p-2",children:Object(r.jsx)(f.a,{children:Object(r.jsx)(b.a,{children:Object(r.jsx)(b.a.Control,{size:"lg",type:"text",placeholder:"Title",value:o,onChange:function(e){return O(e.target.value)}})})})}),Object(r.jsx)(x.a,{className:"p-2",children:Object(r.jsx)(f.a,{children:Object(r.jsx)(W.Editor,{ref:v,initialValue:u,placeholder:"Start writing",previewStyle:"vertical",height:"600px",initialEditType:"wysiwyg",useCommandShortcut:!0,onChange:function(){return S(v.current.getInstance().getMarkdown())}})})})]}):null},$=function(e){var t=e.notes,n=e.activeNote,a=e.onCreateNote,c=e.onRefreshNotes,s=e.onNoteSelected;return Object(r.jsxs)(d.a,{className:"p-2",children:[Object(r.jsxs)(x.a,{className:"p-2",children:[Object(r.jsx)(h.a,{onClick:a,children:Object(r.jsx)(X.a,{icon:Y.b})}),Object(r.jsx)(h.a,{variant:"secondary",onClick:c,children:Object(r.jsx)(X.a,{icon:Y.a})})]}),Object(r.jsx)(x.a,{className:"p-2",children:Object(r.jsx)(v.a,{children:t.map((function(e,t){return Object(r.jsx)(v.a.Item,{action:!0,active:e===n,onClick:function(){return s(e)},children:e},t)}))})})]})};var ee=function(){var e,t=Object(a.useState)({url:"https://nk-server.thegoldenmule.com",userId:void 0,keys:{signing:void 0,encryption:void 0},keyNames:[],values:{}}),n=Object(l.a)(t,2),c=n[0],s=n[1],o=Object(a.useState)(""),u=Object(l.a)(o,2),h=u[0],b=u[1],v=c.keyNames,j=c.values,w=(e=j[h],JSON.stringify(e));return Object(r.jsx)("div",{style:{paddingTop:"20px"},children:Object(r.jsxs)(d.a,{children:[Object(r.jsx)(x.a,{className:"p-2",children:Object(r.jsx)(y.a,{children:Object(r.jsx)(y.a.Brand,{children:"Nk-js Example"})})}),Object(r.jsx)(x.a,{className:"p-2",children:Object(r.jsx)(q,{context:c,onLogin:function(){var e=Object(p.a)(i.a.mark((function e(t){var n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=localStorage.getItem("_context"),r=P(n,t),s(r);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),onCreateUser:Object(p.a)(i.a.mark((function e(){var t,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M(c);case 2:return t=e.sent,s(t),e.next=6,I(t,"111111");case 6:n=e.sent,localStorage.setItem("_context",n);case 8:case"end":return e.stop()}}),e)})))})}),z(c)&&Object(r.jsxs)(x.a,{className:"p-2",children:[Object(r.jsx)(f.a,{xs:3,className:"p-2",children:Object(r.jsx)($,{notes:v,activeNote:h,onCreateNote:Object(p.a)(i.a.mark((function e(){var t,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})),e.next=3,V(c,t,Z({title:"",body:""}));case 3:n=e.sent,s(n),b(t);case 6:case"end":return e.stop()}}),e)}))),onRefreshNotes:Object(p.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D(c);case 2:t=e.sent,s(t);case 4:case"end":return e.stop()}}),e)}))),onNoteSelected:function(e){return b(e)}})}),Object(r.jsx)(f.a,{className:"p-2",children:Object(r.jsx)(Q,{activeNote:h,note:w,onSave:function(){var e=Object(p.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F(c,h,Z(t));case 2:n=e.sent,s(n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()})})]})]})})};n(53);o.a.render(Object(r.jsx)(c.a.StrictMode,{children:Object(r.jsx)(ee,{})}),document.getElementById("root"))}},[[54,1,2]]]);
//# sourceMappingURL=main.58c8839e.chunk.js.map